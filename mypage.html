<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ë‚´ ì •ë³´ ê³µìœ  í—ˆë¸Œ (ê²½ëŸ‰í™” + GAS ì—°ë™)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .main-content-section:not(.active) { display: none; }
        .main-content-section.active { display: block; }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ ìœ ì§€ */
        .db-scroll-area::-webkit-scrollbar { width: 6px; }
        .db-scroll-area::-webkit-scrollbar-thumb { background-color: #a5b4fc; border-radius: 3px; }
        .db-scroll-area::-webkit-scrollbar-track { background-color: #e5e7eb; border-radius: 3px; }
        .db-scroll-area { scrollbar-width: thin; scrollbar-color: #a5b4fc #e5e7eb; }

        #individual-history-list::-webkit-scrollbar { width: 8px; }
        #individual-history-list::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        #individual-history-list::-webkit-scrollbar-track { background-color: #f1f5f9; }
        #individual-history-list { scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9; }

        .progress-bar > div { transition: width 0.5s ease-in-out; }

        /* ìº˜ë¦°ë” ì¼ì • í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .schedule-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 2px;
        }
        .schedule-vacation { background-color: #f87171; }
        .schedule-meeting { background-color: #3b82f6; }
        .schedule-training { background-color: #10b981; }
    </style>
    <script>
        // --- ì „ì—­ ìƒìˆ˜ ë° ì´ˆê¸°í™”ëœ ë°ì´í„° ---
        const TRAINING_GOAL_HOURS = 40;
        let currentCalendarDate = new Date();
        let currentPlanEducationList = []; // í˜„ì¬ ì‘ì„± ì¤‘ì¸ êµìœ¡ ê³„íš ë¦¬ìŠ¤íŠ¸
        let savedPlanData = null; // [New] ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¨ ë‚´ ê³„íš ë°ì´í„° (ìˆ˜ì • ì‹œ ë³µì›ìš©)

        // ********** GAS ì—°ë™ ì„¤ì • (ë‘ ê°œì˜ ì£¼ì†Œ ë¶„ë¦¬) **********
        
        // 1. ê³„íšì„œ ì €ì¥ ë° ì¡°íšŒìš© (DB, POST/GET)
        const GAS_SAVE_API_URL = "https://script.google.com/macros/s/AKfycbwU2V26MIQzI90nAs1T0z-1chcpd6448L6QEZci6Kpts6GVyyaFMkVledprKZkneqUj/exec";

        // 2. í”„ë¡œí•„ ì •ë³´ ì¡°íšŒìš© (ì‚¬ìš©ì ì •ë³´, GET)
        const GAS_PROFILE_API_URL = "https://script.google.com/macros/s/AKfycbzFfTsWR4aE-uUVltWp0wgSk6_whgawDlni1hALxLGMuB-FsMDnKnDcVqtDk_j6WA66/exec";


        // ********** ë¡œê·¸ì¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì„¸ì…˜ ìš°ì„ ) **********
        // 1. URL íŒŒë¼ë¯¸í„°ì—ì„œ íƒìƒ‰
        const urlParams = new URLSearchParams(window.location.search);
        let LOGIN_USER_UID = urlParams.get('userUid') || urlParams.get('uid');
        let LOGIN_USER_NAME = urlParams.get('userName') || urlParams.get('name');

        // 2. URLì— ì—†ìœ¼ë©´ LocalStorage 'edu_user_session' í™•ì¸ (ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ì™€ í˜¸í™˜)
        if (!LOGIN_USER_UID || !LOGIN_USER_NAME) {
            const sessionData = localStorage.getItem('edu_user_session');
            if (sessionData) {
                try {
                    const parsed = JSON.parse(sessionData);
                    if (!LOGIN_USER_UID) LOGIN_USER_UID = parsed.uid;
                    if (!LOGIN_USER_NAME) LOGIN_USER_NAME = parsed.name;
                    console.log("ì„¸ì…˜ ë³µêµ¬ë¨ (MainPage):", LOGIN_USER_NAME);
                } catch (e) {
                    console.error("ì„¸ì…˜ íŒŒì‹± ì˜¤ë¥˜:", e);
                }
            }
        }

        // 3. ê·¸ë˜ë„ ì—†ìœ¼ë©´ êµ¬ë²„ì „ í‚¤ í™•ì¸
        if (!LOGIN_USER_UID) LOGIN_USER_UID = localStorage.getItem('userUid');
        if (!LOGIN_USER_NAME) LOGIN_USER_NAME = localStorage.getItem('userName');

        console.log("Current User:", LOGIN_USER_NAME, "(", LOGIN_USER_UID, ")");

        // ********** Mock Data ë° ê´€ë ¨ ë³€ìˆ˜ ëª¨ë‘ ì œê±°/ì´ˆê¸°í™” **********
        let localUserSchedules = [];
        const mockInquiryHistory = [];
        const mockTrainingHistory = [];
        const mockUpcomingTraining = [];
        let simulatedSharedPosts = [];
        const mockInterestKeywords = [];
        let localScrapedIds = [];

        const currentMonth = currentCalendarDate.getMonth();
        const currentYear = currentCalendarDate.getFullYear();
        const currentDay = currentCalendarDate.getDate();

        // --- ì•„ì´ì½˜ SVG ìƒì„± í•¨ìˆ˜ (ì „ì—­) ---
        function getIconSVG(name, classes) {
            const icons = {
                'User': '<path d="M19 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>',
                'ListChecks': '<path d="M8 6h11"></path><path d="M8 12h11"></path><path d="M8 18h11"></path><path d="M4 6.5l-1.5 1.5l-2.5 -3"></path><path d="M4 12.5l-1.5 1.5l-2.5 -3"></path><path d="M4 18.5l-1.5 1.5l-2.5 -3"></path>',
                'Target': '<circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle>',
                'ClipboardList': '<rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path d="M8 11h.01"></path><path d="M8 16h.01"></path>',
                'Calendar': '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>',
                'Check': '<polyline points="20 6 9 17 4 12"></polyline>',
                'X': '<path d="M18 6L6 18"></path><path d="M6 6l12 12"></path>',
                'Heart': '<path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path>',
                'Star': '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>',
                'Pencil': '<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>',
                'LogOut': '<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line>',
                'Plus': '<line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>',
                'Trash': '<polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>'
            };
            const svgContent = icons[name] || '';
            return `<svg xmlns="http://www.w3.org/2000/svg" class="${classes}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${svgContent}</svg>`;
        }

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        const formatCurrency = (number) => new Intl.NumberFormat('ko-KR', {
            style: 'currency',
            currency: 'KRW',
            minimumFractionDigits: 0
        }).format(number);

        // --- ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ ---
        window.alertMessage = function(message, type = 'info') {
            const box = document.getElementById('message-box');
            let bgColor = { 'info': 'bg-blue-500', 'success': 'bg-green-500', 'error': 'bg-red-500' }[type] || 'bg-blue-500';

            box.textContent = message;
            box.className = `fixed bottom-4 right-4 p-4 text-white rounded-lg shadow-xl z-50 transition-transform duration-300 transform translate-x-0 ${bgColor}`;

            setTimeout(() => { box.classList.add('translate-x-full'); }, 3000);
            setTimeout(() => { box.classList.remove('translate-x-full'); }, 3500);
        }

        // --- Modal Utility Functions ---
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex', 'opacity-100');
            }
        };

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('opacity-100', 'flex');
                modal.classList.add('hidden');
            }
        };

        // --- [New] êµìœ¡ ê³¼ì • ì¶”ê°€ ëª¨ë‹¬ ê´€ë ¨ ---
        window.openEducationAddModal = function() {
            openModal('education-add-modal');
        };

        window.addEducationItem = function(e) {
            e.preventDefault();
            const form = document.getElementById('education-add-form');
            
            // ë‚ ì§œ í¬ë§·íŒ… ë° ê²€ì¦
            const startDate = document.getElementById('edu-period-start').value;
            const endDate = document.getElementById('edu-period-end').value;
            
            if (!startDate || !endDate) {
                window.alertMessage("ìˆ˜ê°• ê¸°ê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.", 'error');
                return;
            }
            if (startDate > endDate) {
                window.alertMessage("ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                return;
            }

            const newItem = {
                id: Date.now(),
                name: document.getElementById('edu-name').value, // ê³¼ì •ëª…
                method: document.getElementById('edu-method').value, // êµìœ¡ë°©ì‹
                institution: document.getElementById('edu-institution').value, // êµìœ¡ê¸°ê´€
                hours: document.getElementById('edu-hours').value, // êµìœ¡ì¸ì •ì‹œê°„
                period: `${startDate}~${endDate}`, // ìˆ˜ê°•ê¸°ê°„ (yyyy-mm-dd~yyyy-mm-dd)
                refund: document.getElementById('edu-refund').value, // í™˜ê¸‰ì—¬ë¶€
                cost: parseInt(document.getElementById('edu-cost').value) || 0 // ë¹„ìš© (ì˜ˆì‚°ê³„ì‚°ìš© ìœ ì§€)
            };

            currentPlanEducationList.push(newItem);
            renderEducationList();
            
            form.reset();
            closeModal('education-add-modal');
        };

        window.removeEducationItem = function(id) {
            currentPlanEducationList = currentPlanEducationList.filter(item => item.id !== id);
            renderEducationList();
        }

        window.renderEducationList = function() {
            const listContainer = document.getElementById('plan-education-list');
            if (!listContainer) return;

            if (currentPlanEducationList.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-gray-400 py-4 text-sm">ë“±ë¡ëœ êµìœ¡ ê³¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>`;
                return;
            }

            let html = '';
            currentPlanEducationList.forEach(item => {
                html += `
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-start group">
                        <div class="flex-grow pr-2">
                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded border border-indigo-100">${item.method}</span>
                                <h4 class="text-sm font-bold text-gray-800">${item.name}</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-gray-600 mt-2">
                                <p>ğŸ« ê¸°ê´€: ${item.institution}</p>
                                <p>â±ï¸ ì‹œê°„: ${item.hours}h</p>
                                <p class="col-span-2">ğŸ“… ê¸°ê°„: ${item.period}</p>
                                <p>ğŸ’° ë¹„ìš©: ${item.cost.toLocaleString()}ì›</p>
                                <p>ğŸ”„ í™˜ê¸‰: ${item.refund.toUpperCase()}</p>
                            </div>
                        </div>
                        <button onclick="removeEducationItem(${item.id})" class="text-gray-400 hover:text-red-500 p-1 flex-shrink-0" title="ì‚­ì œ">
                            ${getIconSVG('Trash', 'w-4 h-4')}
                        </button>
                    </div>
                `;
            });
            listContainer.innerHTML = html;
        }

        // --- ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ---
        window.logout = function() {
            localStorage.removeItem('edu_user_session');
            localStorage.removeItem('userUid');
            localStorage.removeItem('userName');
            window.alertMessage("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
            setTimeout(() => {
                window.location.href = 'index.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            }, 1000);
        }

        // --- DUMMY/MOCKUP FUNCTIONS (ëª¨ë‘ ë¹„í™œì„±í™”) ---
        window.toggleInterest = function(postId, event) {
            event.stopPropagation();
            window.alertMessage("ğŸš§ ê¸°ëŠ¥ ë¹„í™œì„±í™”: Mock ë°ì´í„° ë° ë¡œì§ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
            window.setupSharingListener();
            window.renderInterestList();
        };

        // ********** [ìˆ˜ì •] ê³„íš ì €ì¥ ê¸°ëŠ¥ (GAS ì—°ë™: GAS_SAVE_API_URL ì‚¬ìš©) **********
        window.saveAnnualPlan = async function(e) {
            e.preventDefault();

            // 0. ë¡œê·¸ì¸ ì²´í¬
            if (!LOGIN_USER_UID) {
                window.alertMessage("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì–´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                return;
            }
            
            // 0-1. ë¦¬ìŠ¤íŠ¸ ì²´í¬
            if (currentPlanEducationList.length === 0) {
                window.alertMessage("ìµœì†Œ 1ê°œ ì´ìƒì˜ êµìœ¡ ê³¼ì •ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.", 'error');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;

            // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const title = "2025ë…„ ì—­ëŸ‰ê°œë°œ ê³„íšì„œ"; // ê¸°ë³¸ ì œëª© ì„¤ì •
            const goal = document.getElementById('plan-goal').value;

            // 2. ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ ë° ì˜ˆì‚° í•©ì‚° (UI í‘œì‹œìš©)
            let actionsText = "";
            let totalBudget = 0;
            currentPlanEducationList.forEach((item, index) => {
                actionsText += `${index + 1}. [${item.method}] ${item.name}\n`;
                actionsText += `   - ê¸°ê´€: ${item.institution} / ì‹œê°„: ${item.hours}h\n`;
                actionsText += `   - ê¸°ê°„: ${item.period}\n`;
                actionsText += `   - ë¹„ìš©: ${item.cost.toLocaleString()}ì› (í™˜ê¸‰: ${item.refund})\n`;
                totalBudget += item.cost;
            });

            // ë¡œë”© í‘œì‹œ
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'ì €ì¥ ì¤‘...';

            try {
                // 3. GASë¡œ ë³´ë‚¼ ë°ì´í„° ì¤€ë¹„ (JSON)
                // ì¤‘ìš”: GAS ì½”ë“œì—ì„œ `educationList`ê°€ ìˆìœ¼ë©´ ë°˜ë³µë¬¸ìœ¼ë¡œ í–‰ì„ ì¶”ê°€í•˜ë„ë¡ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
                const payload = {
                    userUid: LOGIN_USER_UID,
                    userName: LOGIN_USER_NAME || 'Unknown',
                    title: title,
                    goal: goal,
                    budget: totalBudget, 
                    educationList: currentPlanEducationList // [ì¤‘ìš”] ë°°ì—´ ë°ì´í„° ì „ì†¡
                };

                // 4. fetchë¡œ ë°ì´í„° ì „ì†¡ (POST) -> GAS_SAVE_API_URL ì‚¬ìš©
                const response = await fetch(GAS_SAVE_API_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                // 5. UI ì—…ë°ì´íŠ¸ (ì„±ê³µ ê°€ì •) - ì €ì¥ í›„ ì¦‰ì‹œ í™”ë©´ì— ë°˜ì˜
                const planContainer = document.getElementById('annual-plan-display');
                if (planContainer) {
                    const today = new Date().toLocaleDateString();
                    const formattedActions = actionsText.replace(/\n/g, '<br>');

                    planContainer.innerHTML = `
                        <div class="p-4 bg-white border border-indigo-300 rounded-xl shadow-inner space-y-3 h-full flex flex-col justify-between">
                            <div class="space-y-3">
                                <div class="flex justify-between items-start border-b border-gray-100 pb-2">
                                    <div>
                                        <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded border border-indigo-100 mb-1 inline-block">ğŸ¯ 2025ë…„</span>
                                        <p class="text-lg font-bold text-gray-800 leading-tight">${title}</p>
                                    </div>
                                    <span class="text-xs font-semibold px-2 py-1 rounded bg-blue-500 text-white shadow-sm flex-shrink-0">ê²°ì¬ ëŒ€ê¸°</span>
                                </div>
                                <div class="bg-yellow-50 p-2 rounded border border-yellow-100">
                                    <p class="text-xs font-bold text-yellow-700 mb-1">ğŸ ì—°ê°„ í•µì‹¬ ëª©í‘œ</p>
                                    <p class="text-sm text-gray-700 font-medium">${goal}</p>
                                </div>
                                <div class="flex-grow">
                                    <p class="text-xs font-bold text-gray-500 mb-1">ğŸ“‹ êµìœ¡ ì´ìˆ˜ ê³„íš ëª©ë¡</p>
                                    <div class="text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 max-h-32 overflow-y-auto custom-scrollbar">
                                        ${formattedActions}
                                    </div>
                                </div>
                                <div class="flex justify-end text-xs text-gray-500 font-medium">
                                    <span>ğŸ’° ì´ ì˜ˆìƒ ì˜ˆì‚°: ${totalBudget.toLocaleString()}ì›</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center pt-2 border-t border-gray-100 text-xs text-gray-500">
                                <span>ì œì¶œì¼: ${today}</span>
                                <button onclick="openEditAnnualPlanModal()" class="px-3 py-1 text-sm font-semibold rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition duration-150 flex items-center">
                                    ìˆ˜ì •
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                // ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ì¡°íšŒí•˜ì—¬ ë°±ì—… (ìˆ˜ì • ê¸°ëŠ¥ìš©)
                fetchMyAnnualPlan();

                window.alertMessage("âœ… 2025ë…„ë„ ì—°ê°„ ì—­ëŸ‰ê°œë°œ ê³„íšì´ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                window.closeModal('annual-plan-modal');

            } catch (error) {
                console.error("ì €ì¥ ì‹¤íŒ¨:", error);
                window.alertMessage("âš ï¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        };

        // ********** [New] ë‚´ ê³„íšì„œ ì¡°íšŒ í•¨ìˆ˜ (ìƒˆë¡œê³ ì¹¨ ì‹œ ë°ì´í„° ìœ ì§€) **********
        async function fetchMyAnnualPlan() {
            if (!LOGIN_USER_UID) return;

            try {
                // ì €ì¥ìš© GAS ì£¼ì†Œë¡œ GET ìš”ì²­ (doGet ì‹¤í–‰ë¨)
                const response = await fetch(`${GAS_SAVE_API_URL}?userUid=${LOGIN_USER_UID}`);
                
                if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜');
                
                const jsonResponse = await response.json();
                
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í™”ë©´ ì—…ë°ì´íŠ¸
                if (jsonResponse.result === 'success' && jsonResponse.data) {
                    const data = jsonResponse.data;
                    savedPlanData = data; // [New] ìˆ˜ì • ì‹œ ë³µì›ì„ ìœ„í•´ ë°ì´í„° ì €ì¥
                    
                    const planContainer = document.getElementById('annual-plan-display');
                    
                    if (planContainer) {
                        // ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±
                        let actionsHtml = '';
                        if (data.educationList && data.educationList.length > 0) {
                             // educationListê°€ ê°ì²´ ë°°ì—´ì¸ ê²½ìš° ì²˜ë¦¬
                             data.educationList.forEach((item, index) => {
                                 actionsHtml += `${index + 1}. [${item.method}] ${item.name}`;
                                 if(item.institution) actionsHtml += ` (${item.institution})`;
                                 actionsHtml += `<br>`;
                                 // ìƒì„¸ ì •ë³´ëŠ” ë“¤ì—¬ì“°ê¸°ë¡œ í‘œì‹œ
                                 actionsHtml += `&nbsp;&nbsp;&nbsp;- ê¸°ê°„: ${item.period} / ì‹œê°„: ${item.hours}h<br>`;
                                 actionsHtml += `&nbsp;&nbsp;&nbsp;- ë¹„ìš©: ${parseInt(item.cost).toLocaleString()}ì› (í™˜ê¸‰: ${item.refund})<br>`;
                             });
                        } else {
                            // êµ¬ë²„ì „ ë°ì´í„° í˜¸í™˜
                            actionsHtml = (data.actions || 'ìƒì„¸ ë‚´ìš© ì—†ìŒ').replace(/\n/g, '<br>');
                        }
                        
                        const today = new Date().toLocaleDateString();

                        planContainer.innerHTML = `
                            <div class="p-4 bg-white border border-indigo-300 rounded-xl shadow-inner space-y-3 h-full flex flex-col justify-between">
                                <div class="space-y-3">
                                    <div class="flex justify-between items-start border-b border-gray-100 pb-2">
                                        <div>
                                            <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded border border-indigo-100 mb-1 inline-block">ğŸ¯ ì—°ê°„ê³„íš</span>
                                            <p class="text-lg font-bold text-gray-800 leading-tight">${data.title}</p>
                                        </div>
                                        <span class="text-xs font-semibold px-2 py-1 rounded bg-blue-500 text-white shadow-sm flex-shrink-0">${data.status || 'ê²°ì¬ëŒ€ê¸°'}</span>
                                    </div>
                                    <div class="bg-yellow-50 p-2 rounded border border-yellow-100">
                                        <p class="text-xs font-bold text-yellow-700 mb-1">ğŸ ì—°ê°„ í•µì‹¬ ëª©í‘œ</p>
                                        <p class="text-sm text-gray-700 font-medium">${data.goal}</p>
                                    </div>
                                    <div class="flex-grow">
                                        <p class="text-xs font-bold text-gray-500 mb-1">ğŸ“‹ êµìœ¡ ì´ìˆ˜ ê³„íš ëª©ë¡</p>
                                        <div class="text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 max-h-32 overflow-y-auto custom-scrollbar">
                                            ${actionsHtml}
                                        </div>
                                    </div>
                                    <div class="flex justify-end text-xs text-gray-500 font-medium">
                                        <span>ğŸ’° ì´ ì˜ˆìƒ ì˜ˆì‚°: ${data.budget ? parseInt(data.budget).toLocaleString() : '0'}ì›</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-gray-100 text-xs text-gray-500">
                                    <span>ë¶ˆëŸ¬ì˜´: ${today}</span>
                                    <button onclick="openEditAnnualPlanModal()" class="px-3 py-1 text-sm font-semibold rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition duration-150 flex items-center">
                                        ìˆ˜ì • (ë®ì–´ì“°ê¸°)
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error("ê³„íšì„œ ì¡°íšŒ ì‹¤íŒ¨:", error);
            }
        }
        
        // ********** [New] ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ (ë°ì´í„° ë³µì› í¬í•¨) **********
        window.openEditAnnualPlanModal = function() {
            if (!savedPlanData) {
                window.alertMessage("ìˆ˜ì •í•  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", "error");
                return;
            }

            // 1. ê¸°ì¡´ ë°ì´í„° ë³µì›
            document.getElementById('plan-title').value = savedPlanData.title || "2025ë…„ ì—­ëŸ‰ê°œë°œ ê³„íšì„œ";
            document.getElementById('plan-goal').value = savedPlanData.goal || "";
            
            // 2. ë¦¬ìŠ¤íŠ¸ ë³µì›
            if (savedPlanData.educationList && Array.isArray(savedPlanData.educationList)) {
                // DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ì—ëŠ” idê°€ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¬ë¶€ì—¬
                currentPlanEducationList = savedPlanData.educationList.map((item, index) => ({
                    ...item,
                    id: Date.now() + index, // ìœ ë‹ˆí¬í•œ ID ìƒì„±
                    cost: parseInt(item.cost) || 0 // ìˆ«ì í˜•ë³€í™˜
                }));
            } else {
                currentPlanEducationList = [];
            }
            
            renderEducationList();
            
            // 3. ëª¨ë‹¬ ì—´ê¸°
            openModal('annual-plan-modal');
        }

        window.saveUserSchedule = function(e) {
            e.preventDefault();
            window.alertMessage("ğŸš§ ê¸°ëŠ¥ ë¹„í™œì„±í™”: Mock ë°ì´í„° ë° ë¡œì§ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
            window.closeModal('schedule-add-modal');
        };

        window.deleteUserSchedule = function(scheduleId, event) {
            event.stopPropagation();
            window.alertMessage("ğŸš§ ê¸°ëŠ¥ ë¹„í™œì„±í™”: Mock ë°ì´í„° ë° ë¡œì§ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
            window.closeModal('day-detail-modal');
        }

        window.saveTrainingComment = function(e) {
            e.preventDefault();
            window.alertMessage("ğŸš§ ê¸°ëŠ¥ ë¹„í™œì„±í™”: Mock ë°ì´í„° ë° ë¡œì§ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
            window.closeModal('training-detail-modal');
        }

        window.sharePost = function(e) {
            e.preventDefault();
            window.alertMessage("ğŸš§ ê¸°ëŠ¥ ë¹„í™œì„±í™”: Mock ë°ì´í„° ë° ë¡œì§ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
        }

        // --- ë Œë”ë§ ë¡œì§ (ë°ì´í„° ì œê±° ë° ì´ˆê¸°í™”) ---
        function renderAchievementSummary() {
            let totalHours = 0;
            let totalCost = 0;
            let totalNetCost = 0;

            const achievementRate = (totalHours / TRAINING_GOAL_HOURS) * 100;
            const safeRate = Math.max(0, Math.min(100, achievementRate));
            const rateText = `${totalHours.toFixed(1)}ì‹œê°„ / ${TRAINING_GOAL_HOURS}ì‹œê°„ (${safeRate.toFixed(1)}%)`;
            const totalCostText = formatCurrency(totalCost);
            const totalNetCostText = formatCurrency(totalNetCost);

            const html = `
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div class="col-span-1">
                        <p class="text-md font-bold text-indigo-700 mb-2">ì´ ë‹¬ì„±ìœ¨: ${rateText}</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: ${safeRate}%;"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="col-span-1">
                            <strong class="block text-xs font-semibold text-gray-500">ì´ êµìœ¡ ë¹„ìš©:</strong>
                            <span class="font-bold text-teal-600">${totalCostText}</span>
                        </div>
                        <div class="col-span-1">
                            <strong class="block text-xs font-semibold text-gray-500">ìˆœìˆ˜ ë¶€ë‹´ ë¹„ìš©:</strong>
                            <span class="font-bold text-red-600">${totalNetCostText}</span>
                        </div>
                    </div>
                    <div class="bg-red-100 p-2 text-sm text-red-700 rounded-md">âš ï¸ ì´ ì„¹ì…˜ì˜ ë°ì´í„°ëŠ” ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
                </div>
            `;
            return `<div class="p-4 border border-indigo-200 bg-indigo-50 rounded-lg h-full">${html}</div>`;
        }

        window.fetchAndRenderAnnualPlan = function() {
            const planContainer = document.getElementById('annual-plan-display');
            if (!planContainer) return;

            const writeButton = `
                <button onclick="openModal('annual-plan-modal')" class="px-3 py-1 text-sm font-semibold rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition duration-150 shadow-md flex items-center">
                    ${getIconSVG('Pencil', 'w-4 h-4 mr-1')} 
                    ê³„íš ìˆ˜ë¦½í•˜ê¸°
                </button>
            `;

            planContainer.innerHTML = `
                <div class="p-4 bg-white border border-indigo-300 rounded-xl shadow-inner space-y-2 h-full flex flex-col justify-between">
                    <div>
                        <p class="text-xs font-semibold text-gray-500">ë‚˜ì˜ ê¸ˆë…„ë„ êµìœ¡ ê³„íš</p>
                        <div class="flex justify-between items-start">
                            <p class="text-lg font-bold text-gray-400 truncate pr-4">ë“±ë¡ëœ ì—°ê°„ ê³„íšì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full bg-gray-200 text-gray-500 flex-shrink-0">ë¯¸ìˆ˜ë¦½</span>
                        </div>
                        <p class="text-sm text-gray-400 mt-2">1ë…„ ë™ì•ˆ ë‹¬ì„±í•  ì—­ëŸ‰ ëª©í‘œì™€ êµ¬ì²´ì ì¸ êµìœ¡ ê³„íšì„ ìˆ˜ë¦½í•´ë³´ì„¸ìš”.</p>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-gray-100 text-xs text-gray-500">
                        <span>ì‘ì„±ì¼: -</span>
                        ${writeButton}
                    </div>
                </div>
            `;
        }

        window.applyTrainingFilters = function() {
            const typeFilter = document.getElementById('type-filter')?.value || 'All';
            const refundFilter = document.getElementById('refund-filter')?.value || 'All';
            window.fetchTrainingData(typeFilter, refundFilter);
        }

        window.fetchTrainingData = function(typeFilter = 'All', refundFilter = 'All') {
            const individualHistoryList = document.getElementById('individual-history-list');
            if(individualHistoryList) individualHistoryList.innerHTML = `<p class="text-gray-500 p-4 font-semibold">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ì´ìˆ˜ ë‚´ì—­ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        function renderInquiryHistory() {
            const container = document.getElementById('inquiry-history-list');
            if (!container) return;
            container.innerHTML = `<p class="text-center text-gray-500 p-4">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ì´ë ¥ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        function renderKeywordList() {
            const container = document.getElementById('keyword-list-container');
            if (!container) return;
            container.innerHTML = `<p class="text-center text-gray-500 col-span-full p-4">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ í‚¤ì›Œë“œ ëª©ë¡ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        window.openTrainingDetailModal = function(itemId) {
            const modal = document.getElementById('training-detail-modal');
            const item = { course: 'ë°ì´í„° ë¡œë“œ ë¶ˆê°€', host: 'N/A', type: 'N/A', period: 'N/A', hours: 0, cost: 0, refund: 'N/A' };

            document.getElementById('detail-course-name').textContent = item.course;
            document.getElementById('detail-item-id').value = itemId;

            document.getElementById('detail-content-body').innerHTML = `
                <div class="space-y-2 text-sm text-gray-700">
                    <div class="flex justify-between border-b pb-1"><span class="font-semibold text-gray-500">ì£¼ê´€/í˜•íƒœ:</span><span>${item.host} (${item.type})</span></div>
                    <div class="flex justify-between border-b pb-1"><span class="font-semibold text-gray-500">ì´ìˆ˜ ê¸°ê°„:</span><span>${item.period}</span></div>
                    <div class="flex justify-between border-b pb-1"><span class="font-semibold text-gray-500">ì¸ì • ì‹œê°„:</span><span class="font-bold text-indigo-600">${item.hours.toFixed(1)}h</span></div>
                    <div class="flex justify-between border-b pb-1"><span class="font-semibold text-gray-500">ì´ ë¹„ìš© / í™˜ê¸‰ ì—¬ë¶€:</span><span class="font-bold text-gray-500">${formatCurrency(item.cost)} (${item.refund})</span></div>
                </div>
                <div class="mt-4 p-3 bg-red-100 rounded-lg">
                    <p class="text-red-500 font-bold mb-1">âš ï¸ ë°ì´í„° ì €ì¥/ë¡œë“œ ê¸°ëŠ¥ì€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            document.getElementById('detail-user-comment').value = '';
            document.getElementById('detail-attachment').value = '';
            document.getElementById('detail-user-comment').disabled = true;
            document.getElementById('detail-attachment').disabled = true;
            document.getElementById('comment-save-btn').disabled = true;

            openModal('training-detail-modal');
        }

        function renderUpcomingTrainingList() {
            const upcomingListContainer = document.getElementById('upcoming-list-container');
            if (!upcomingListContainer) return;
            upcomingListContainer.innerHTML = `<p class="text-gray-500 p-2 font-semibold">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ì¼ì •ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        function renderCalendar() {
            const calendarContainer = document.getElementById('calendar-container');
            if (!calendarContainer) return;

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const schedulesInMonth = {};

            function getDayColor(dayIndex) {
                if (dayIndex === 0) return 'text-red-500'; 
                if (dayIndex === 6) return 'text-blue-500'; 
                return 'text-gray-700';
            }

            let html = `
                <div class="flex justify-between items-center mb-2">
                    <button onclick="changeMonth(-1)" class="p-2 rounded-full hover:bg-gray-100 text-gray-700" aria-label="ì´ì „ ë‹¬">${getIconSVG('X', 'w-5 h-5 transform rotate-45')}</button>
                    <h5 class="text-xl font-bold text-indigo-700">${year}ë…„ ${month + 1}ì›”</h5>
                    <button onclick="changeMonth(1)" class="p-2 rounded-full hover:bg-gray-100 text-gray-700" aria-label="ë‹¤ìŒ ë‹¬">${getIconSVG('X', 'w-5 h-5 transform -rotate-45')}</button>
                </div>
                <div class="flex-grow flex flex-col justify-between">
                    <table class="w-full text-center border-collapse rounded-lg overflow-hidden flex-grow">
                        <thead>
                            <tr class="text-xs font-semibold text-gray-500 bg-gray-100">
                                <th class="py-1 ${getDayColor(0)}">ì¼</th>
                                <th class="py-1 ${getDayColor(1)}">ì›”</th>
                                <th class="py-1 ${getDayColor(2)}">í™”</th>
                                <th class="py-1 ${getDayColor(3)}">ìˆ˜</th>
                                <th class="py-1 ${getDayColor(4)}">ëª©</th>
                                <th class="py-1 ${getDayColor(5)}">ê¸ˆ</th>
                                <th class="py-1 ${getDayColor(6)}">í† </th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            let day = 1;
            let todayDate = new Date();
            todayDate.setHours(0, 0, 0, 0);

            for (let i = 0; i < 6; i++) {
                html += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < firstDayOfMonth || day > daysInMonth) {
                        html += '<td class="p-0.5 border border-gray-100 bg-gray-50"></td>';
                    } else {
                        const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const isToday = new Date(dateKey + 'T00:00:00').getTime() === todayDate.getTime();

                        let dayClasses = `p-0.5 border border-gray-100 text-sm font-medium h-8 align-top cursor-pointer transition duration-150 hover:bg-indigo-50`;
                        if (isToday) {
                            dayClasses += ' bg-amber-100 border-2 border-amber-500 rounded-lg shadow-inner';
                        }

                        const schedulesOnDay = schedulesInMonth[dateKey] || [];
                        let scheduleDots = '';

                        html += `<td class="${dayClasses}" onclick="openDayDetailModal('${dateKey}')">`;
                        html += `<span class="${getDayColor(j)} block text-xs">${day}</span>`;
                        if (scheduleDots) {
                            html += `<div class="mt-0.5 flex justify-center flex-wrap">${scheduleDots}</div>`;
                        }
                        html += `</td>`;
                        day++;
                    }
                }
                html += '</tr>';
                if (day > daysInMonth) break;
            }

            html += `</tbody></table></div>`;
            calendarContainer.innerHTML = html;
        }

        window.changeMonth = function(offset) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + offset);
            renderCalendar();
            renderUpcomingTrainingList(); 
        }

        window.openDayDetailModal = function(dateKey) {
            const detailModal = document.getElementById('day-detail-modal');
            if (!detailModal) return;

            const dateTitle = document.getElementById('day-detail-date');
            const listContainer = document.getElementById('day-event-list');
            const targetDate = new Date(dateKey + 'T00:00:00');

            if (dateTitle) dateTitle.textContent = `${targetDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' })} ì¼ì •`;
            listContainer.innerHTML = `<p class="text-center text-gray-500 p-4">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. (ë°ì´í„° ë¡œì§ ì œê±°ë¨)</p>`;

            const scheduleDateInput = document.getElementById('schedule-date');
            if (scheduleDateInput) {
                scheduleDateInput.value = dateKey;
            }
            openModal('day-detail-modal');
        }

        window.renderInterestList = function() {
            const listContainer = document.getElementById('interest-list-container');
            if (!listContainer) return;
            listContainer.innerHTML = `<p class="text-center text-gray-500 p-4">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ëª©ë¡ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        window.setupSharingListener = function() {
            const sharedList = document.getElementById('shared-list');
            if(!sharedList) return;
            sharedList.innerHTML = `<p class="text-center text-gray-500 p-4">âš ï¸ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
        }

        // ********** NEW: GAS í”„ë¡œí•„ ë°ì´í„° ì—°ë™ í•¨ìˆ˜ **********
        async function fetchUserProfile() {
            const statusMsg = document.getElementById('profile-status-msg');

            // 1. [ì¦‰ì‹œ ì‹¤í–‰] LocalStorageì— ìˆëŠ” ì •ë³´ë¡œ ìš°ì„  í™”ë©´ ì±„ìš°ê¸°
            if (LOGIN_USER_UID && document.getElementById('profile-uid')) {
                document.getElementById('profile-uid').textContent = LOGIN_USER_UID;
            }
            if (LOGIN_USER_NAME && document.getElementById('profile-name')) {
                document.getElementById('profile-name').textContent = LOGIN_USER_NAME;
            }

            // 2. ë¡œê·¸ì¸ ì •ë³´ê°€ ì•„ì˜ˆ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
            if (!LOGIN_USER_UID) {
                if(statusMsg) {
                    statusMsg.className = "col-span-2 text-xs text-red-500 pt-2 border-t border-red-200";
                    statusMsg.textContent = "âš ï¸ ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.";
                }
                return; // í•¨ìˆ˜ ì¢…ë£Œ
            }

            try {
                // 3. GAS ìš”ì²­ (community.html ë°©ì‹ê³¼ í†µì¼: ì „ì²´ ë¡œë“œ í›„ í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§)
                // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” ë³´ë‚´ì§€ë§Œ, ì‘ë‹µì´ ë°°ì—´ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•©ë‹ˆë‹¤.
                const response = await fetch(GAS_PROFILE_API_URL); // íŒŒë¼ë¯¸í„° ì—†ì´ í˜¸ì¶œ ì‹œë„ (í˜¹ì€ ìˆì–´ë„ ë¬´ë°©)

                if (!response.ok) {
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
                }

                const jsonResponse = await response.json();
                console.log("Profile Data Response:", jsonResponse); // ë””ë²„ê¹…ìš©

                // ì„±ê³µ ì—¬ë¶€ í™•ì¸ (status ë˜ëŠ” result í‚¤ ëª¨ë‘ í—ˆìš©)
                const isSuccess = (jsonResponse.status === 'success' || jsonResponse.result === 'success');
                
                if (isSuccess && jsonResponse.data) {
                    let userData = null;

                    // Case A: ì‘ë‹µì´ ë°°ì—´ì¸ ê²½ìš° (community.html ë°©ì‹) -> í•„í„°ë§ í•„ìš”
                    if (Array.isArray(jsonResponse.data)) {
                         userData = jsonResponse.data.find(user => String(user.userUid) === String(LOGIN_USER_UID));
                    } 
                    // Case B: ì‘ë‹µì´ ë‹¨ì¼ ê°ì²´ì¸ ê²½ìš° (ê¸°ì¡´ ë°©ì‹)
                    else {
                        userData = jsonResponse.data;
                    }

                    if (userData) {
                        // ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ HTML IDì— ë§¤ì¹­í•˜ì—¬ ë„£ê¸°
                        if(document.getElementById('profile-name')) document.getElementById('profile-name').textContent = userData.userName || LOGIN_USER_NAME || '-';
                        if(document.getElementById('profile-uid')) document.getElementById('profile-uid').textContent = userData.userUid || LOGIN_USER_UID || '-';
                        if(document.getElementById('profile-dept')) document.getElementById('profile-dept').textContent = userData.deptName || '-';
                        if(document.getElementById('profile-grade')) document.getElementById('profile-grade').textContent = userData.gradeName || '-';
                        if(document.getElementById('profile-email')) document.getElementById('profile-email').textContent = userData.sysmail || '-';

                        // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                        if(statusMsg) {
                            statusMsg.className = "col-span-2 text-xs text-green-600 pt-2 border-t border-green-200";
                            statusMsg.textContent = "âœ… ìµœì‹  ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.";
                        }
                    } else {
                        // ë°°ì—´ì—ì„œ ëª» ì°¾ì€ ê²½ìš°
                        if(statusMsg) {
                            statusMsg.className = "col-span-2 text-xs text-red-500 pt-2 border-t border-red-200";
                            statusMsg.textContent = "âš ï¸ í•´ë‹¹ ì‚¬ë²ˆì˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                        }
                    }
                } else {
                    // ì‘ë‹µ ì‹¤íŒ¨
                    if(statusMsg) {
                        statusMsg.className = "col-span-2 text-xs text-red-500 pt-2 border-t border-red-200";
                        statusMsg.textContent = "âš ï¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ (" + (jsonResponse.message || "ì›ì¸ ë¶ˆëª…") + ")";
                    }
                }

            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                if(statusMsg) {
                    statusMsg.className = "col-span-2 text-xs text-red-500 pt-2 border-t border-red-200";
                    statusMsg.textContent = "âš ï¸ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (CORS ë˜ëŠ” URL í™•ì¸ í•„ìš”)";
                }
            }
        }

        function startDataListeners() {
            window.fetchAndRenderAnnualPlan(); 
            renderCalendar();
            renderUpcomingTrainingList(); 
            // ********** í”„ë¡œí•„ ë°ì´í„° í˜¸ì¶œ **********
            fetchUserProfile();
            // ********** [New] ë‚´ ê³„íšì„œ í˜¸ì¶œ **********
            fetchMyAnnualPlan();
        }

        // --- íƒ­ ì „í™˜ í•¨ìˆ˜ ---
        window.switchMainContent = function(contentId) {
            document.querySelectorAll('#sidebar-nav button').forEach(btn => {
                btn.classList.remove('bg-indigo-100', 'text-indigo-700', 'font-bold');
                btn.classList.add('text-gray-700', 'hover:bg-gray-50');
            });

            const activeBtn = document.querySelector(`#sidebar-nav button[data-content="${contentId}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('text-gray-700', 'hover:bg-gray-50');
                activeBtn.classList.add('bg-indigo-100', 'text-indigo-700', 'font-bold');
            }

            document.querySelectorAll('.main-content-section').forEach(section => {
                section.classList.remove('active');
            });

            const activeSection = document.getElementById(contentId);
            if (activeSection) {
                activeSection.classList.add('active');
            }

            if (contentId === 'personal-info-section') {
                document.getElementById('achievement-summary-display').innerHTML = renderAchievementSummary();
                window.fetchAndRenderAnnualPlan();
                renderCalendar();
                renderUpcomingTrainingList();
            }
            if (contentId === 'individual-history-section') {
                window.applyTrainingFilters(); 
            }
            if (contentId === 'interest-list-section') { 
                window.renderInterestList(); 
                document.getElementById('team-status-display').innerHTML = `<p class="text-gray-700 p-2 font-semibold">íŒ€ êµìœ¡ í˜„í™© ë°ì´í„°ëŠ” í˜„ì¬ ë¹„í™œì„±í™”ë˜ì–´ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>`;
            }
            if (contentId === 'sharing-board-section') {
                window.setupSharingListener(); 
            }
            if (contentId === 'inquiry-section') {
                renderInquiryHistory();
            }
        }
        
        // --- ì´ˆê¸°í™” ë° ì‹œì‘ ---
        window.onload = () => {
            document.getElementById('loading-indicator').classList.add('hidden');
            startDataListeners();
            window.switchMainContent('personal-info-section'); 
            
            const sharingForm = document.getElementById('sharing-form');
            if(sharingForm) {
                sharingForm.addEventListener('submit', window.sharePost);
            }
        }
    </script>

    <!-- Global Message Box -->
    <div id="message-box" class="fixed bottom-4 right-4 p-4 text-white rounded-lg shadow-xl z-50 transition-transform transform translate-x-full bg-blue-500"></div>

    <!-- ê¸ˆë…„ë„ êµìœ¡ê³„íš ì‘ì„± ëª¨ë‹¬ (ìˆ˜ì •: ì—°ê°„ ëª©í‘œ ì¤‘ì‹¬ ë° êµìœ¡ ë¦¬ìŠ¤íŠ¸) -->
    <div id="annual-plan-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-transform duration-300 scale-100" onclick="event.stopPropagation()">
            <form onsubmit="window.saveAnnualPlan(event)" class="flex flex-col h-full">
                <!-- Header -->
                <div class="p-6 pb-2 border-b flex justify-between items-center bg-white rounded-t-xl z-10">
                    <h3 class="text-2xl font-bold text-indigo-700">ì—°ê°„ ì—­ëŸ‰ê°œë°œ ê³„íšì„œ</h3>
                    <button type="button" onclick="closeModal('annual-plan-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                    </button>
                </div>
                
                <!-- Scrollable Content -->
                <div class="p-6 overflow-y-auto flex-grow space-y-6">
                    <div class="bg-indigo-50 border-l-4 border-indigo-400 p-3 text-sm text-indigo-700">
                        <p class="font-bold mb-1">ğŸ’¡ ì‘ì„± ê°€ì´ë“œ</p>
                        <p>ì˜¬í•´ ë‹¬ì„±í•  í•µì‹¬ ëª©í‘œë¥¼ ì •í•˜ê³ , ì´ë¥¼ ìœ„í•œ êµ¬ì²´ì ì¸ êµìœ¡ ê³¼ì •ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                    </div>

                    <!-- 1. ê¸°ë³¸ ì •ë³´ & í•µì‹¬ ëª©í‘œ -->
                    <div class="space-y-4">
                        <div>
                            <label for="plan-goal" class="block text-sm font-bold text-gray-800 mb-1 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                                ê¸ˆë…„ë„ í•µì‹¬ ëª©í‘œ <span class="text-red-500 ml-1">*</span>
                            </label>
                            <input id="plan-goal" type="text" placeholder="ì˜ˆ: í˜„ì—… ë°ì´í„° ë¶„ì„ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ë° ìê²©ì¦ ì·¨ë“" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-yellow-50" required>
                        </div>
                    </div>

                    <!-- 2. êµìœ¡ ì´ìˆ˜ ê³„íš ëª©ë¡ (ìŠ¤í¬ë¡¤ ì˜ì—­) -->
                    <div class="space-y-2">
                        <div class="flex justify-between items-center mb-1">
                            <label class="block text-sm font-bold text-gray-800 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6h11"></path><path d="M8 12h11"></path><path d="M8 18h11"></path><path d="M4 6.5l-1.5 1.5l-2.5 -3"></path><path d="M4 12.5l-1.5 1.5l-2.5 -3"></path><path d="M4 18.5l-1.5 1.5l-2.5 -3"></path></svg>
                                êµìœ¡ ì´ìˆ˜ ê³„íš ëª©ë¡
                            </label>
                            <button type="button" onclick="window.openEducationAddModal()" class="text-xs px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 font-bold transition flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> ê³¼ì • ì¶”ê°€
                            </button>
                        </div>
                        
                        <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
                        <div id="plan-education-list" class="space-y-2 max-h-60 overflow-y-auto p-1 db-scroll-area border border-gray-200 rounded-lg bg-gray-50 min-h-[100px]">
                            <p class="text-center text-gray-400 py-8 text-sm">ë“±ë¡ëœ êµìœ¡ ê³¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>

                <!-- Footer Buttons -->
                <div class="p-4 border-t bg-gray-50 rounded-b-xl flex justify-end space-x-3">
                    <button type="button" onclick="closeModal('annual-plan-modal')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 font-semibold">ì·¨ì†Œ</button>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition duration-150 shadow-md flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg> ê³„íš ì œì¶œ (ì €ì¥)
                    </button>
                </div>
            </form>
            <script>document.getElementById('annual-plan-modal').addEventListener('click', (e) => { if(e.target.id === 'annual-plan-modal') closeModal('annual-plan-modal'); });</script>
        </div>
    </div>

    <!-- [New] êµìœ¡ ê³¼ì • ì¶”ê°€ íŒì—… (Nested Modal) -->
    <div id="education-add-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-80 items-center justify-center p-4 z-[60] transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-transform duration-300 scale-100" onclick="event.stopPropagation()">
            <form id="education-add-form" onsubmit="window.addEducationItem(event)" class="p-5 space-y-4">
                <div class="flex justify-between items-center border-b pb-2">
                    <h4 class="text-lg font-bold text-gray-800">êµìœ¡ ê³¼ì • ì¶”ê°€</h4>
                    <button type="button" onclick="closeModal('education-add-modal')" class="p-1 text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">ê³¼ì •ëª… <span class="text-red-500">*</span></label>
                        <input type="text" id="edu-name" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm" required>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-600 mb-1">êµìœ¡ ë°©ì‹</label>
                            <select id="edu-method" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸</option>
                                <option value="ì˜¤í”„ë¼ì¸">ì˜¤í”„ë¼ì¸</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600 mb-1">êµìœ¡ ê¸°ê´€</label>
                            <input type="text" id="edu-institution" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                         <div>
                            <label class="block text-xs font-semibold text-gray-600 mb-1">ì¸ì • ì‹œê°„ (h)</label>
                            <input type="number" id="edu-hours" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm text-right">
                        </div>
                        <div>
                             <label class="block text-xs font-semibold text-gray-600 mb-1">í™˜ê¸‰ ì—¬ë¶€</label>
                            <select id="edu-refund" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                <option value="O">O</option>
                                <option value="X">X</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">ìˆ˜ê°• ê¸°ê°„</label>
                        <div class="flex items-center gap-2">
                            <input type="date" id="edu-period-start" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm" required>
                            <span class="text-gray-500 font-bold">~</span>
                            <input type="date" id="edu-period-end" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">ì˜ˆìƒ ë¹„ìš© (ì›)</label>
                        <input type="number" id="edu-cost" placeholder="0" class="w-full p-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500 text-sm text-right">
                    </div>
                    <!-- ì„¸ë¶€ ë‚´ìš© í•„ë“œëŠ” ìœ ì§€í•˜ì§€ ì•ŠìŒ (ì‚¬ìš©ì ìš”ì²­ í•­ëª© ìœ„ì£¼ë¡œ êµ¬ì„±) -->
                    <input type="hidden" id="edu-detail" value=""> 
                </div>

                <div class="flex justify-end pt-2">
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-700 shadow">ì¶”ê°€</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê°œì¸ ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="schedule-add-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm transform transition-transform duration-300 scale-100" onclick="event.stopPropagation()">
            <form onsubmit="window.saveUserSchedule(event)" class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-xl font-bold text-teal-700">ê°œì¸ ì¼ì • ì¶”ê°€</h3>
                    <button type="button" onclick="closeModal('schedule-add-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div class="bg-red-50 border-l-4 border-red-400 text-red-700 p-3 text-sm" role="alert">
                    <p class="font-semibold">âš ï¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”</p>
                    <p>ì´ ì–‘ì‹ì€ ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>
                <div>
                    <label for="schedule-title" class="block text-sm font-medium text-gray-700 mb-1">ì¼ì • ì œëª©</label>
                    <input id="schedule-title" type="text" name="schedule-title" placeholder="ì˜ˆ: íŒ€ íšŒì‹" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" required disabled>
                </div>
                <div>
                    <label for="schedule-date" class="block text-sm font-medium text-gray-700 mb-1">ë‚ ì§œ</label>
                    <input id="schedule-date" type="date" name="schedule-date" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" required disabled>
                </div>
                <div>
                    <label for="schedule-type" class="block text-sm font-medium text-gray-700 mb-1">ì¼ì • ìœ í˜•</label>
                    <select id="schedule-type" name="schedule-type" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" required disabled>
                        <option value="meeting">íšŒì˜/í–‰ì‚¬ (íŒŒë‘)</option>
                        <option value="training">êµìœ¡/ì›Œí¬ìˆ (ì´ˆë¡)</option>
                        <option value="vacation">íœ´ê°€/ìë¦¬ë¹„ì›€ (ë¹¨ê°•)</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-2">
                    <button type="submit" class="px-4 py-2 bg-teal-600 text-white rounded-lg font-bold hover:bg-teal-700 transition duration-150 shadow-md flex items-center" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg> ì €ì¥ (ë¹„í™œì„±í™”)
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì¼ë³„ ìƒì„¸ ì¼ì • ëª¨ë‹¬ -->
    <div id="day-detail-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-100" onclick="event.stopPropagation()">
            <div class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 id="day-detail-date" class="text-xl font-bold text-indigo-700">ìƒì„¸ ì¼ì •</h3>
                    <button type="button" onclick="closeModal('day-detail-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                    </button>
                </div>
                <ul id="day-event-list" class="space-y-3">
                    <p class="text-center text-gray-500 p-4">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. (ë°ì´í„° ë¡œì§ ì œê±°ë¨)</p>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- êµìœ¡ ìƒì„¸ ë° ê°œì¸ ë©”ëª¨ ëª¨ë‹¬ -->
    <div id="training-detail-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-100" onclick="event.stopPropagation()">
            <form onsubmit="window.saveTrainingComment(event)" class="p-6 bg-white rounded-xl space-y-4">
                <input type="hidden" id="detail-item-id" value="">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-indigo-700" id="detail-course-name">êµìœ¡ ìƒì„¸ ì •ë³´</h3>
                    <button type="button" onclick="closeModal('training-detail-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                    </button>
                </div>
                
                <div id="detail-content-body" class="mb-6 p-4 border border-gray-200 rounded-lg">
                    <p class="text-red-500 font-bold">ë°ì´í„° ì—°ë™ ë¹„í™œì„±í™”ë¡œ êµìœ¡ ìƒì„¸ ì •ë³´ê°€ ë¡œë“œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>

                <div class="pt-4 border-t border-gray-100">
                    <label for="detail-user-comment" class="block text-lg font-semibold text-gray-700 mb-2">ë‚˜ì˜ ê°œì¸ ë©”ëª¨ / í›„ê¸°</label>
                    <textarea id="detail-user-comment" rows="4" placeholder="êµìœ¡ ì´ìˆ˜ ì†Œê°, ì ìš© ê³„íš, ê°œì¸ì ì¸ ì½”ë©˜íŠ¸ ë“±ì„ ì‘ì„±í•˜ì„¸ìš”. (ì €ì¥ ê¸°ëŠ¥ ë¹„í™œì„±í™”)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" disabled></textarea>
                    
                    <div class="mt-4">
                        <label for="detail-attachment" class="block text-sm font-semibold text-gray-700 mb-1">ì²¨ë¶€ íŒŒì¼ ì„ íƒ (íŒŒì¼ëª…ë§Œ ì €ì¥ë¨)</label>
                        <input type="file" id="detail-attachment" name="detail-attachment" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" disabled/>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button type="submit" id="comment-save-btn" class="px-4 py-2 bg-teal-600 text-white rounded-lg font-bold hover:bg-teal-700 transition duration-150 shadow-md flex items-center" disabled>
                            ${getIconSVG('Check', 'w-4 h-4 mr-1')} ë©”ëª¨ ì €ì¥ (ë¹„í™œì„±í™”)
                        </button>
                    </div>
                </div>
                
            </form>
        </div>
    </div>


    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <!-- Column 1 (lg:col-span-1): ì‚¬ì´ë“œë°”/ë„¤ë¹„ê²Œì´ì…˜ -->
        <aside class="lg:col-span-1 space-y-6">
            <header class="p-4 bg-white rounded-xl shadow-lg border-t-4 border-indigo-500">
                <h1 class="text-2xl font-extrabold text-indigo-700">ë§ˆì´ í˜ì´ì§€</h1>
                <div id="loading-indicator" class="mt-2 text-indigo-500 font-semibold flex items-center hidden">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    ë°ì´í„° ë¡œë“œ ì¤‘...
                </div>
            </header>

            <!-- ê°œì¸ í”„ë¡œí•„ -->
            <div class="bg-white p-4 rounded-xl shadow-lg border-t-4 border-teal-500">
                <h3 class="text-lg font-bold text-teal-700 mb-3 border-b pb-2 flex justify-between items-center">
                    <span class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        ê°œì¸ í”„ë¡œí•„
                    </span>
                    <button onclick="logout()" class="p-1.5 text-red-500 hover:text-red-700 hover:bg-red-100 rounded-md" title="ë¡œê·¸ì•„ì›ƒ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    </button>
                </h3>
                <!-- ********** ìˆ˜ì •: ID ë¶€ì—¬ëœ í”„ë¡œí•„ ì„¹ì…˜ ********** -->
                <div id="personal-info-display" class="p-5 border border-teal-200 bg-teal-50 rounded-lg space-y-1 text-sm">
                    <div class="grid grid-cols-2 gap-y-5 gap-x-4 text-sm">
                        <div class="col-span-1 flex flex-col">
                            <strong class="text-xs font-semibold text-gray-500">ì´ë¦„:</strong>
                            <span id="profile-name" class="font-semibold text-gray-800 break-words">-</span>
                        </div>
                        <div class="col-span-1 flex flex-col">
                            <strong class="text-xs font-semibold text-gray-500">ì‚¬ë²ˆ:</strong>
                            <span id="profile-uid" class="text-gray-800 break-words">-</span>
                        </div>
                        <div class="col-span-2 flex flex-col">
                            <strong class="text-xs font-semibold text-gray-500">ë¶€ì„œ:</strong>
                            <span id="profile-dept" class="text-gray-800 break-words">-</span>
                        </div>
                        <div class="col-span-1 flex flex-col">
                            <strong class="text-xs font-semibold text-gray-500">ì§ì±…:</strong>
                            <span id="profile-grade" class="text-gray-800 break-words">-</span>
                        </div>
                        <div class="col-span-1 flex flex-col">
                            <strong class="text-xs font-semibold text-gray-500">ì´ë©”ì¼:</strong>
                            <span id="profile-email" class="text-gray-800 break-all break-words">-</span>
                        </div>
                    </div>
                    <p id="profile-status-msg" class="col-span-2 text-xs text-indigo-500 pt-2 border-t border-indigo-200 animate-pulse">
                        ğŸ”„ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </p>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <nav id="sidebar-nav" class="bg-white p-2 rounded-xl shadow-lg space-y-1 h-80">
                <h3 class="text-sm font-semibold text-gray-500 px-3 pt-2 pb-1">ë©”ì¸ ë©”ë‰´</h3>
                <button 
                    data-content="personal-info-section" 
                    onclick="switchMainContent('personal-info-section')" 
                    class="w-full text-left flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-150 active bg-indigo-100 text-indigo-700 font-bold"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> ê¸ˆë…„ë„ êµìœ¡ í˜„í™©
                </button>
                <button 
                    data-content="individual-history-section" 
                    onclick="switchMainContent('individual-history-section')" 
                    class="w-full text-left flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-150"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6h11"></path><path d="M8 12h11"></path><path d="M8 18h11"></path><path d="M4 6.5l-1.5 1.5l-2.5 -3"></path><path d="M4 12.5l-1.5 1.5l-2.5 -3"></path><path d="M4 18.5l-1.5 1.5l-2.5 -3"></path></svg> êµìœ¡ ì´ìˆ˜ ì´ë ¥
                </button>
                <button 
                    data-content="interest-list-section" 
                    onclick="switchMainContent('interest-list-section')" 
                    class="w-full text-left flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-150"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg> ì €ì¥ ëª©ë¡
                </button>
                <button 
                    data-content="sharing-board-section" 
                    onclick="switchMainContent('sharing-board-section')" 
                    class="w-full text-left flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-150"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M11 4a9 9 0 0 1 9 9"></path><path d="M21 21l-7.38-7.38"></path></svg> êµìœ¡ ê³µìœ  ê²Œì‹œíŒ
                </button>
                <button 
                    data-content="inquiry-section" 
                    onclick="switchMainContent('inquiry-section')" 
                    class="w-full text-left flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-150"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path d="M8 11h.01"></path><path d="M8 16h.01"></path></svg> ë¬¸ì˜/ì‘ì„± ì´ë ¥
                </button>
            </nav>
        </aside>

        <!-- Column 2 (lg:col-span-3): ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
        <main class="lg:col-span-3 space-y-8">

            <!-- 0. [ê³ ì • ì„¹ì…˜] ëŒ€ì‹œë³´ë“œ: ì¼ì • ë° ìº˜ë¦°ë” (ë©”ë‰´ ì „í™˜ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í‘œì‹œ) -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-500 h-[420px] flex flex-col">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">ëŒ€ì‹œë³´ë“œ: ì¼ì • ë° ìº˜ë¦°ë”</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow overflow-hidden">
                    <!-- Upcoming List (1/3) -->
                    <div class="lg:col-span-1 bg-gray-50 p-3 rounded-xl border border-indigo-200 shadow-md h-full flex flex-col">
                        <h4 class="text-lg font-bold text-indigo-700 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> 
                            ë‹¤ê°€ì˜¤ëŠ” ì¼ì •
                        </h4>
                        <div id="upcoming-list-container" class="space-y-3 db-scroll-area overflow-y-auto flex-grow pr-1">
                            <p class="text-gray-500 text-sm">ë°ì´í„° ë¡œì§ì´ ì œê±°ë˜ì–´ ì¼ì •ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                    <!-- Calendar (2/3) -->
                    <div class="lg:col-span-2 bg-white p-2 rounded-xl h-full flex flex-col">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-lg font-bold text-indigo-700">ì›”ê°„ ìº˜ë¦°ë”</h4>
                            <button onclick="openModal('schedule-add-modal')" class="px-3 py-1 text-sm font-semibold rounded-lg bg-teal-600 text-white hover:bg-teal-700 transition duration-150 shadow-md flex items-center" disabled>
                                + ì¼ì • ì¶”ê°€
                            </button>
                        </div>
                        <div id="calendar-container" class="select-none flex-grow overflow-hidden">
                            <p class="text-center text-gray-500 p-8">ìº˜ë¦°ë” ë¡œë“œ ì¤‘...</p>
                        </div>
                        <div class="flex space-x-4 justify-end text-xs text-gray-600 pt-2 border-t mt-auto">
                            <span class="flex items-center"><span class="schedule-dot schedule-meeting mr-1"></span>íšŒì˜</span>
                            <span class="flex items-center"><span class="schedule-dot schedule-training mr-1"></span>êµìœ¡</span>
                            <span class="flex items-center"><span class="schedule-dot schedule-vacation mr-1"></span>íœ´ê°€</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1. [ê°€ë³€ ì„¹ì…˜] ê¸ˆë…„ë„ êµìœ¡ ê³„íš ë° ë‹¬ì„±ë¥  (ë©”ë‰´ 'ê¸ˆë…„ë„ êµìœ¡ í˜„í™©' ì„ íƒ ì‹œ í‘œì‹œ) -->
            <div id="personal-info-section" class="main-content-section active space-y-8 mt-12">
                
                <!-- [í•˜ë‹¨ ì¹´ë“œ] êµìœ¡ ê³„íš ë° ë‹¬ì„±ë¥  -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-500">
                    <div class="flex flex-col md:flex-row md:space-x-8 space-y-6 md:space-y-0 h-full">
                        
                        <!-- êµìœ¡ ê³„íš (2/3) -->
                        <div class="w-full md:w-2/3 flex flex-col"> 
                            <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2 flex items-center justify-between">
                                <span>ê¸ˆë…„ë„ êµìœ¡ ê³„íš</span>
                                <span class="text-xs font-normal text-gray-500">2025ë…„ë„ ëª©í‘œ</span>
                            </h3>
                            <div id="annual-plan-display" class="flex-grow">
                                <div class="p-4 bg-gray-50 border border-indigo-200 rounded-xl space-y-2 h-full flex flex-col justify-between">
                                    <div>
                                        <div class="flex justify-between items-start mb-2">
                                            <p class="text-lg font-bold text-gray-600">ë°ì´í„° ë¡œë“œ ë¶ˆê°€</p>
                                            <span class="text-xs font-semibold px-2 py-1 rounded bg-gray-400 text-white">Inactive</span>
                                        </div>
                                        <p class="text-sm text-gray-600">ë°ì´í„° ì—°ë™ ë¡œì§ì´ ì œê±°ë˜ì–´ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                                    </div>
                                    <div class="flex justify-end pt-2 border-t border-gray-200">
                                        <button onclick="openModal('annual-plan-modal')" class="px-3 py-1 text-sm font-semibold rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition duration-150 shadow-md flex items-center">
                                            ${getIconSVG('Pencil', 'w-4 h-4 mr-1')} 
                                            ê³„íš ìˆ˜ë¦½í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ë‹¬ì„±ë¥  ìš”ì•½ (1/3) -->
                        <div class="w-full md:w-1/3 flex flex-col"> 
                            <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">êµìœ¡ ë‹¬ì„±ë¥  ìš”ì•½</h3>
                            <div id="achievement-summary-display" class="p-4 border border-indigo-200 bg-indigo-50 rounded-lg flex-grow flex items-center justify-center">
                                <p class="text-gray-500">ë°ì´í„° ë¡œë“œ ì¤‘...</p>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
