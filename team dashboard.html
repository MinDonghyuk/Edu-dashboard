<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPCBì‚¬ì—…ë³¸ë¶€ í’ˆì§ˆê²½ì˜íŒ€ ëŒ€ì‹œë³´ë“œ</title>
    
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js for Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <!-- FullCalendar CSS and JS (Core and DayGrid) -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales-all.global.min.js'></script>


    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f6f8; }
        .card { border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2cpx rgba(0, 0, 0, 0.1); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .db-scroll-area::-webkit-scrollbar { width: 6px; }
        .db-scroll-area::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        .db-scroll-area::-webkit-scrollbar-track { background-color: #f1f5f9; border-radius: 3px; }
        .db-scroll-area { scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9; }
        
        /* FullCalendar Custom Styles */
        .fc .fc-toolbar-title { font-size: 1.25rem !important; font-weight: 700 !important; }
        .fc .fc-button { background-color: #3B82F6 !important; border-color: #3B82F6 !important; }
        .fc .fc-event { border-radius: 0.25rem; cursor: pointer; } /* ì»¤ì„œ í¬ì¸í„° ì¶”ê°€ */
        
        /* Custom scroll class for team goals */
        .goals-scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 1rem; /* Space for scroll bar */
        }
        .goal-card {
            display: inline-block;
            width: 250px;
            vertical-align: top;
            margin-right: 1rem;
        }
        
        /* Custom dropdown styles */
        .evaluation-dropdown {
            position: relative;
            display: inline-block;
        }
        .evaluation-menu {
            position: absolute;
            right: 0;
            z-index: 10;
            width: 80px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3B82F6', 'soft-blue': '#EFF6FF', 'soft-green': '#ECFDF5',
                        'soft-yellow': '#FFFBEB', 'soft-pink': '#FDF2F8', 'soft-purple': '#F3F4F6',
                        'soft-rose': '#FFF1F2', 'soft-teal': '#F0FDF4',
                    }
                }
            }
        }

        // --- Mock Data ---
        const FPCB_MEMBERS = [
            { name: 'ë°•ë™í˜', id: '20220458', team: 'í’ˆì§ˆê²½ì˜íŒ€', totalTime: '14.0 ì‹œê°„', externalTime: '9.0 ì‹œê°„', goalTime: 20.0, externalCost: 10000, internalCost: 0, carCost: 50000, transitCost: 30000, etcCost: 20000 },
            { name: 'ê¹€ë™í˜', id: '201920458', team: 'í’ˆì§ˆê²½ì˜íŒ€', totalTime: '8.0 ì‹œê°„', externalTime: '5.0 ì‹œê°„', goalTime: 15.0, externalCost: 0, internalCost: 0, carCost: 20000, transitCost: 15000, etcCost: 15000 }
        ];

        let IN_PROGRESS_TRAININGS = [
            // MODIFIED: 'format'ì— ì˜¤í”„ë¼ì¸ ì¥ì†Œ ì •ë³´ í¬í•¨
            { id: 't1', name: 'ISO 9001 ì‹¬í™” ê³¼ì •', duration: '2025.10.25~2025.11.25', attendees: ['ë°•ë™í˜', 'ê¹€ë™í˜'], type: 'ì‚¬ì™¸', cost: '10,000ì›', format: 'ì˜¨ë¼ì¸', appliedDate: '2025-10-20' },
            { id: 't2', name: 'í’ˆì§ˆ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê¸°ì´ˆ', duration: '2025.11.01~2025.11.30', attendees: ['ë°•ë™í˜'], type: 'ìƒì‹œ', cost: '0ì›', format: 'ì˜¤í”„ë¼ì¸ (ë³¸ì‚¬ 3ì¸µ êµìœ¡ì¥)', appliedDate: '2025-10-15' }
        ];
        
        let IN_PROGRESS_DETAILS_MAP = {
            't1': { 'ê³¼ì •ëª…': 'ISO 9001 ì‹¬í™” ê³¼ì •', 'ë‚´ìš©': 'ISO 9001 í‘œì¤€ì˜ ì‹¬ì¸µ ë¶„ì„ ë° ì‹¤ë¬´ ì ìš© ë°©ì•ˆ í•™ìŠµ. ìµœì‹  ê°œì • ì‚¬í•­ ë°˜ì˜.', 'ëª©ì ': 'íŒ€ì› ì „ì²´ì˜ í’ˆì§ˆê²½ì˜ ì‹œìŠ¤í…œ ì´í•´ë„ í–¥ìƒ ë° ë‚´ë¶€ ê°ì‚¬ ì—­ëŸ‰ ê°•í™”.', 'ê¸°ëŒ€íš¨ê³¼': 'ì‹œìŠ¤í…œ ì•ˆì •í™” ë° ì¬ì‘ì—…ë¥  5% ê°ì†Œ ì˜ˆìƒ.', 'êµìœ¡ìš”ì•½': 'ì´ 4ì£¼ ê³¼ì •, ì˜¨ë¼ì¸ ê°•ì˜ ë° ì£¼ 1íšŒ ì‹¤ìŠµ ì„¸ì…˜ ì§„í–‰.', 'ì—…ë¬´ì ìš©ê³„íš': 'êµìœ¡ ì´ìˆ˜ í›„ 2026ë…„ 1ë¶„ê¸° ë‚´ë¶€ ê°ì‚¬ ê³„íš ìˆ˜ë¦½ì— ì¦‰ì‹œ ì°¸ì—¬.', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'í‰ê°€ ê¸°ê°„ ì¤‘ ì£¼ìš” ì—…ë¬´ ë¶€í•˜ë¡œ ì¸í•œ í•™ìŠµ ì‹œê°„ í™•ë³´ ì–´ë ¤ì›€ ì˜ˆìƒ.', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2026-04-01' }, // êµ¬ì²´ì ì¸ ë‚ ì§œë¡œ ê°€ì •
            't2': { 'ê³¼ì •ëª…': 'í’ˆì§ˆ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê¸°ì´ˆ', 'ë‚´ìš©': 'FMEA ê¸°ë°˜ì˜ ë¦¬ìŠ¤í¬ ì‹ë³„, ë¶„ì„, í‰ê°€ ë° ëŒ€ì‘ ì „ëµ ìˆ˜ë¦½ ì›Œí¬ìˆ.', 'ëª©ì ': 'ì ì¬ì  í’ˆì§ˆ ë¬¸ì œ ì‚¬ì „ ì˜ˆë°© ë° ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì²´ê³„ í™•ë¦½.', 'ê¸°ëŒ€íš¨ê³¼': 'ì¤‘ìš” ë¦¬ìŠ¤í¬ ë°œìƒë¥  10% ê°ì†Œ ë° ëŒ€ì‘ ì‹œê°„ ë‹¨ì¶•.', 'êµìœ¡ìš”ì•½': 'ì‚¬ë‚´ ì›Œí¬ìˆ í˜•íƒœì˜ 2ì¼ ì§‘ì¤‘ ê³¼ì •.', 'ì—…ë¬´ì ìš©ê³„íš': 'í˜„í–‰ ê³µì •ì— FMEA í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ì…í•˜ê³  íŒ€ ë‚´ì— ì „íŒŒ.', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ì´ˆê¸° FMEA ë„ì… ì‹œ íŒ€ì›ë“¤ì˜ ì¶”ê°€ ì—…ë¬´ ë¶€ë‹´.', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2025-12-31' } // êµ¬ì²´ì ì¸ ë‚ ì§œë¡œ ê°€ì •
        };

        const EDUCATION_REPORT_MAP = {
            'e3': { 'ë‚´ìš©': 'FPCB ê³µì • ì¤‘ ë°œìƒí•˜ëŠ” ì£¼ìš” í’ˆì§ˆ ì´ìŠˆ í•´ê²°ì„ ìœ„í•œ ì‹¬ì¸µ ê¸°ìˆ  êµìœ¡ ì´ìˆ˜.', 'ëª©ì ': 'ì œì¡° ê³µì • í’ˆì§ˆ ê´€ë¦¬ ì—­ëŸ‰ í–¥ìƒ ë° ë¶ˆëŸ‰ë¥  ê°ì†Œ.', 'ê¸°ëŒ€íš¨ê³¼': 'ê³µì • ì¤‘ë‹¨ ì‹œê°„ 15% ë‹¨ì¶• ë° í’ˆì§ˆ ê¸°ì¤€ ë§Œì¡±ë„ í–¥ìƒ.', 'êµìœ¡ìš”ì•½': '40ì‹œê°„ ì˜¨ë¼ì¸ ë° 10ì‹œê°„ í˜„ì¥ ì‹¤ìŠµ.', 'ì—…ë¬´ì ìš©ê³„íš': 'êµìœ¡ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í’ˆì§ˆ ê´€ë¦¬ ë§¤ë‰´ì–¼ì„ ì—…ë°ì´íŠ¸í•˜ê³  íŒ€ì›ë“¤ì—ê²Œ ê³µìœ .', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ìƒˆë¡œìš´ ë¶„ì„ ë„êµ¬ ë„ì…ì— í•„ìš”í•œ ì˜ˆì‚° í™•ë³´ê°€ ì§€ì—°ë¨.', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2026-01-15' },
            'e4': { 'ë‚´ìš©': 'í˜„ì¥ ì •ë¦¬ ì •ëˆ ë° í‘œì¤€í™” í™œë™ ë¦¬ë” ì–‘ì„± í”„ë¡œê·¸ë¨ ì´ìˆ˜.', 'ëª©ì ': '5S í™œë™ì„ ì£¼ë„í•˜ê³  íš¨ìœ¨ì ì¸ ì‘ì—… í™˜ê²½ì„ ì¡°ì„±.', 'ê¸°ëŒ€íš¨ê³¼': 'ì•ˆì „ì‚¬ê³  ë°œìƒë¥  0% ë° ì‘ì—… ëŠ¥ë¥  5% í–¥ìƒ.', 'êµìœ¡ìš”ì•½': '2ì¼ê°„ì˜ ì›Œí¬ìˆ ë° 1ê°œì›”ê°„ í˜„ì¥ í”„ë¡œì íŠ¸ ì§„í–‰.', 'ì—…ë¬´ì ìš©ê³„íš': 'ë§¤ì£¼ 5S í™œë™ ì ê²€ ë° ê°œì„  ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ì—¬ íŒ€ì— ë³´ê³ .', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ì´ˆê¸° íŒ€ì›ë“¤ì˜ ì°¸ì—¬ ë™ê¸° ë¶€ì—¬ê°€ ì–´ë ¤ì›€.', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2025-10-01' },
            'e5': { 'ë‚´ìš©': 'Pythonì„ í™œìš©í•œ í’ˆì§ˆ ë°ì´í„° ì¶”ì¶œ ë° ì‹œê°í™” ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ê¸°ìˆ  ìŠµë“.', 'ëª©ì ': 'ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ëŠ¥ë ¥ ë°°ì–‘', 'ê¸°ëŒ€íš¨ê³¼': 'ë°˜ë³µ ì—…ë¬´ ìë™í™”ë¡œ ê³µìˆ˜ 10% ì ˆê°', 'êµìœ¡ìš”ì•½': '8ì£¼ ì˜¨ë¼ì¸ ê³¼ì •', 'ì—…ë¬´ì ìš©ê³„íš': 'í’ˆì§ˆ ë°ì´í„° ì¶”ì¶œ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ì—…ë¬´ ì‹œê°„ì´ ë¶€ì¡±í•¨', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2025-12-01' }, 
            'e6': { 'ë‚´ìš©': 'ìµœì‹  ë°˜ë„ì²´ ê³µì • íë¦„ ë° ì œì¡° ê¸°ìˆ ì˜ í•µì‹¬ ì›ë¦¬ ì´í•´.', 'ëª©ì ': 'ê³ ê°ì‚¬ ê¸°ìˆ  ì´í•´ë„ í–¥ìƒ', 'ê¸°ëŒ€íš¨ê³¼': 'ì„ í–‰ í’ˆì§ˆ ê´€ë¦¬ ì—­ëŸ‰ ê°•í™”', 'êµìœ¡ìš”ì•½': '3ì¼ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜', 'ì—…ë¬´ì ìš©ê³„íš': 'ê¸°ìˆ  ë™í–¥ ë³´ê³ ì„œ ì‘ì„±', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ì¶œì¥ ì¼ì • ì¡°ìœ¨ì˜ ì–´ë ¤ì›€', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': '2025-11-15' }
        };

        const ALL_EDUCATIONS_MASTER = [
            { id: 'e5', name: 'ì‚¬ë‚´ ì½”ë”© êµìœ¡ (Python)', empId: '201920458', empName: 'ê¹€ë™í˜', dept: 'FPCBì‚¬ì—…ë³¸ë¶€', status: 'ì´ìˆ˜ì™„ë£Œ', period: '2025.08.01~2025.09.25', type: 'ì˜¨ë¼ì¸', source: 'ìƒì‹œ', hours: 8.0, cost: 0, refundable: 'X', evaluation: 'ì¤‘' },
            { id: 'e6', name: 'ìµœì‹  ë°˜ë„ì²´ ê³µì • ê¸°ìˆ  ì´í•´', empId: '201920458', empName: 'ê¹€ë™í˜', dept: 'FPCBì‚¬ì—…ë³¸ë¶€', status: 'ì´ìˆ˜ì™„ë£Œ', period: '2025.10.01~2025.10.03', type: 'ì˜¤í”„ë¼ì¸', source: 'ì‚¬ì™¸', hours: 4.0, cost: 30000, refundable: 'O', evaluation: 'ìƒ' },
            
            { id: 'e3', name: 'FPCB í’ˆì§ˆê´€ë¦¬ ì‹¬í™”', empId: '20220458', empName: 'ë°•ë™í˜', dept: 'FPCBì‚¬ì—…ë³¸ë¶€', status: 'ì´ìˆ˜ì™„ë£Œ', period: '2025.09.01~2025.09.30', type: 'ì˜¤í”„ë¼ì¸', source: 'ì‚¬ì™¸', hours: 10.0, cost: 10000, refundable: 'O', evaluation: 'ìƒ' }, 
            { id: 'e4', name: '5S í™œë™ ë¦¬ë” êµìœ¡', empId: '20220458', empName: 'ë°•ë™í˜', dept: 'FPCBì‚¬ì—…ë³¸ë¶€', status: 'ì´ìˆ˜ì™„ë£Œ', period: '2025.07.01~2025.07.31', type: 'ì˜¤í”„ë¼ì¸', source: 'ì‚¬ì™¸', hours: 4.0, cost: 0, refundable: 'X', evaluation: 'ì¤‘' },
        ];
        
        const ALL_EDUCATIONS_FILTERABLE = ALL_EDUCATIONS_MASTER;

        // --- NEW: íŒ€ ëª©í‘œ ë§ˆìŠ¤í„° ë°ì´í„° (í•˜ë‚˜ì˜ ë°ì´í„° ì†ŒìŠ¤) ---
        let TEAM_MASTER_DATA = [
            // í’ˆì§ˆê²½ì˜íŒ€ (4.0/25.0 = 16.0%) - ì¸ì›ìˆ˜: 2ëª… (FPCB_MEMBERS.length)
            { team: 'í’ˆì§ˆê²½ì˜íŒ€ (FPCB)', color: '#3B82F6', memberCount: FPCB_MEMBERS.length, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'ISO/í’ˆì§ˆí‘œì¤€ êµìœ¡', targetHours: 15, achievedHours: 4.0 },
                { name: 'AI ê¸°ë°˜ ë¶ˆëŸ‰ ì˜ˆì¸¡', targetHours: 10, achievedHours: 0.0 }
            ]},
            // ì „ì¥ì‚¬ì—…íŒ€ (7.0/20.0 = 35.0%) - ì¸ì›ìˆ˜: 3ëª… (ì„ì˜)
            { team: 'ì „ì¥ì‚¬ì—…íŒ€', color: '#F59E0B', memberCount: 3, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'ì°¨ì„¸ëŒ€ ì „ì¥ ê¸°ìˆ  ì‹¬í™”', targetHours: 12, achievedHours: 5.0 },
                { name: 'í”„ë¡œì íŠ¸ ê´€ë¦¬(PM)', targetHours: 8, achievedHours: 2.0 }
            ]},
            // ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤íŒ€ (10.0/25.0 = 40.0%) - ì¸ì›ìˆ˜: 5ëª… (ì„ì˜)
            { team: 'ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤íŒ€', color: '#8B5CF6', memberCount: 5, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'ì •ë°€ ì œì–´ ì‹œìŠ¤í…œ', targetHours: 20, achievedHours: 10.0 }, // 10.0 ì‹œê°„ í• ë‹¹
                { name: 'ê³µì • ìë™í™”', targetHours: 5, achievedHours: 0.0 }
            ]},
            // ì˜ì—…íŒ€ (12.0/15.0 = 80.0%) - ì¸ì›ìˆ˜: 4ëª… (ì„ì˜)
            { team: 'ì˜ì—…íŒ€', color: '#10B981', memberCount: 4, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'í•´ì™¸ ì‹œì¥ ë¶„ì„', targetHours: 10, achievedHours: 8.0 }, // 8.0 ì‹œê°„ í• ë‹¹
                { name: 'ê³ ê° í˜‘ìƒ ìŠ¤í‚¬', targetHours: 5, achievedHours: 4.0 } // 4.0 ì‹œê°„ í• ë‹¹
            ]},
            // í†µí•©êµ¬ë§¤íŒ€ (10.0/20.0 = 50.0%) - ì¸ì›ìˆ˜: 3ëª… (ì„ì˜)
            { team: 'í†µí•©êµ¬ë§¤íŒ€', color: '#EC4899', memberCount: 3, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'ê³µê¸‰ë§ ë¦¬ìŠ¤í¬ ê´€ë¦¬', targetHours: 12, achievedHours: 6.0 }, // 6.0 ì‹œê°„ í• ë‹¹
                { name: 'ê¸€ë¡œë²Œ ì†Œì‹± ì „ëµ', targetHours: 8, achievedHours: 4.0 } // 4.0 ì‹œê°„ í• ë‹¹
            ]},
            // FPCB ì‚¬ì—…íŒ€ (20.0/25.0 = 80.0%) - ì¸ì›ìˆ˜: 6ëª… (ì„ì˜)
            { team: 'FPCB ì‚¬ì—…íŒ€', color: '#EAB308', memberCount: 6, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'FPCB ì„¤ê³„ ê¸°ì¤€ ì´í•´', targetHours: 15, achievedHours: 15.0 }, // 15.0 ì‹œê°„ í• ë‹¹
                { name: 'ì‹ ì†Œì¬ ë¶„ì„', targetHours: 10, achievedHours: 5.0 } // 5.0 ì‹œê°„ í• ë‹¹
            ]},
            // ê°œë°œíŒ€ (5.0/25.0 = 20.0%) - ì¸ì›ìˆ˜: 4ëª… (ì„ì˜)
            { team: 'ê°œë°œíŒ€', color: '#EF4444', memberCount: 4, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'ì„ë² ë””ë“œ SW ê°œë°œ', targetHours: 18, achievedHours: 5.0 }, // 5.0 ì‹œê°„ í• ë‹¹
                { name: 'ì‹ ë¢°ì„± í…ŒìŠ¤íŠ¸', targetHours: 7, achievedHours: 0.0 }
            ]},
            // ì¤‘ì•™ì—°êµ¬ì†Œ (15.0/35.0 = 42.9%) - ì¸ì›ìˆ˜: 1ëª… (ì„ì˜)
            { team: 'ì¤‘ì•™ì—°êµ¬ì†Œ', color: '#06B6D4', memberCount: 1, totalGoalTime: 0, totalAchievedTime: 0, achievedRate: 0, goals: [
                { name: 'R&D ë…¼ë¬¸ ì‘ì„±ë²•', targetHours: 20, achievedHours: 10.0 }, // 10.0 ì‹œê°„ í• ë‹¹
                { name: 'íŠ¹í—ˆ ì¶œì› ë° ê´€ë¦¬', targetHours: 15, achievedHours: 5.0 } // 5.0 ì‹œê°„ í• ë‹¹
            ]},
        ];

        // --- í—¬í¼ í•¨ìˆ˜ ---
        const getNumericTime = (timeString) => parseFloat(timeString.replace(' ì‹œê°„', '').trim());
        const formatCurrency = (number) => new Intl.NumberFormat('ko-KR').format(number) + 'ì›';
        
        // --- NEW: ë°ì´í„° ì´ˆê¸°í™” ë° ê³„ì‚° í•¨ìˆ˜ ---
        function initializeTeamData() {
            TEAM_MASTER_DATA.forEach(team => {
                let totalGoal = 0;
                let totalAchieved = 0;
                
                team.goals.forEach(goal => {
                    totalGoal += goal.targetHours;
                    totalAchieved += goal.achievedHours;
                });
                
                team.totalGoalTime = totalGoal;
                team.totalAchievedTime = totalAchieved;
                
                if (totalGoal > 0) {
                    // ë‹¬ì„±ë¥  ê³„ì‚° ë° ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ ë°˜ì˜¬ë¦¼
                    team.achievedRate = Math.min(100, (totalAchieved / totalGoal) * 100);
                } else {
                    team.achievedRate = 0;
                }
            });
            
            // í˜„ì¬ íŒ€ ì´ë¦„ì„ ì¶”ì¶œ (í˜ì´ì§€ íƒ€ì´í‹€ ê¸°ë°˜)
            const pageTitle = document.title;
            const currentTeamMatch = pageTitle.match(/([ê°€-í£A-Z]+íŒ€)/);
            const currentTeamName = currentTeamMatch ? currentTeamMatch[1] : 'í’ˆì§ˆê²½ì˜íŒ€';
            const currentTeamKey = currentTeamName === 'í’ˆì§ˆê²½ì˜íŒ€' ? 'í’ˆì§ˆê²½ì˜íŒ€ (FPCB)' : currentTeamName; 

            // í˜„ì¬ íŒ€ì„ ë§¨ ìœ„ë¡œ ì •ë ¬ (Yì¶• ë§¨ ìœ„ë¡œ ê°€ë„ë¡)
            TEAM_MASTER_DATA.sort((a, b) => {
                if (a.team === currentTeamKey) return 1;
                if (b.team === currentTeamKey) return -1;
                return 0;
            });
        }
        
        // --- NEW: ì§„í–‰ ì¤‘ì¸ êµìœ¡ ê±´ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateInProgressCount() {
            const countElement = document.getElementById('inProgressTrainingCount');
            if (countElement) {
                countElement.textContent = IN_PROGRESS_TRAININGS.length;
            }
        }
        
        // --- NEW: Calendar Rendering Function (Section 1) ---
        function renderCalendar() {
            const calendarEl = document.getElementById('trainingCalendar');
            if (!calendarEl) return;
            
            // FullCalendar Event Data
            const events = IN_PROGRESS_TRAININGS.map(training => {
                // ê¸°ê°„ ë¬¸ìì—´ 'YYYY.MM.DD~YYYY.MM.DD'ë¥¼ íŒŒì‹±
                const [startStr, endStr] = training.duration.split('~');
                const startDate = startStr.replace(/\./g, '-').trim();
                // FullCalendarëŠ” endDateë¥¼ exclusive(í¬í•¨í•˜ì§€ ì•ŠìŒ)ë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ, 
                // ì¢…ë£Œì¼ì— í•˜ë£¨ë¥¼ ë”í•˜ì—¬ í‘œì‹œ
                const endDateParts = endStr.replace(/\./g, '-').trim().split('-');
                let endDate = new Date(parseInt(endDateParts[0]), parseInt(endDateParts[1]) - 1, parseInt(endDateParts[2]));
                endDate.setDate(endDate.getDate() + 1);

                return {
                    title: training.attendees.join(', '), // MODIFIED: ì´ë¦„(ì°¸ì—¬ì)ë§Œ í‘œì‹œí•˜ë„ë¡ ë³€ê²½
                    start: startDate,
                    end: endDate.toISOString().split('T')[0], // YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    color: training.type === 'ì‚¬ì™¸' ? '#3B82F6' : '#10B981', // Blue for External, Green for Internal/Ongoing
                    id: training.id,
                    // MODIFIED: íˆ´íŒì„ ìœ„í•œ ì¶”ê°€ ì •ë³´ ì „ë‹¬ (ê³¼ì •ëª… ì¶”ê°€)
                    extendedProps: {
                        courseName: training.name, // íˆ´íŒì— ê³¼ì •ëª…ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì¶”ê°€
                        format: training.format, // ì˜ˆ: 'ì˜¤í”„ë¼ì¸ (ë³¸ì‚¬ 3ì¸µ êµìœ¡ì¥)' or 'ì˜¨ë¼ì¸'
                        attendees: training.attendees.join(', ')
                    }
                };
            });

            // ê¸°ì¡´ ìº˜ë¦°ë” ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆë‹¤ë©´ ì œê±°í•˜ê³  ë‹¤ì‹œ ë Œë”ë§ (ì¼ì • ì¶”ê°€ ë°˜ì˜ ìœ„í•¨)
            if (calendarEl.calendar) {
                calendarEl.calendar.destroy();
            }

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko', // í•œêµ­ì–´ ë¡œì¼€ì¼ ì„¤ì •
                // === MODIFIED: Custom buttons and headerToolbar ===
                customButtons: {
                    addScheduleButton: {
                        text: 'ì¼ì • ì¶”ê°€',
                        click: openAddScheduleModal 
                    }
                },
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'addScheduleButton' // dayGridMonth,dayGridWeek ì œê±° ë° ì¼ì • ì¶”ê°€ ë²„íŠ¼ ë°°ì¹˜
                },
                fixedWeekCount: false, // ë‹¬ë ¥ ë†’ì´ë¥¼ ë‚´ìš©ì— ë§ê²Œ ì¡°ì • (ìŠ¤í¬ë¡¤ ì œê±°)
                height: 'auto', // ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì •
                // ===============================================
                events: events,
                
                // MODIFIED: ì¦‰ì‹œ ë°˜ì‘í•˜ëŠ” ì»¤ìŠ¤í…€ íˆ´íŒ êµ¬í˜„
                eventDidMount: function(info) {
                    const tooltip = document.getElementById('calendar-tooltip');
                    const props = info.event.extendedProps;
                    
                    // ë§ˆìš°ìŠ¤ ì§„ì… ì‹œ
                    info.el.onmouseenter = function(e) {
                        const content = `
                            <div class="font-bold text-sm mb-1 text-yellow-300">ğŸ“Œ ${props.courseName}</div>
                            <div class="text-xs text-white">ğŸ“ ${props.format}</div>
                        `;
                        tooltip.innerHTML = content;
                        tooltip.classList.remove('hidden');
                        
                        // ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •
                        tooltip.style.left = (e.clientX + 15) + 'px';
                        tooltip.style.top = (e.clientY + 15) + 'px';
                    };

                    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ (íˆ´íŒì´ ë§ˆìš°ìŠ¤ë¥¼ ë”°ë¼ë‹¤ë‹˜)
                    info.el.onmousemove = function(e) {
                        tooltip.style.left = (e.clientX + 15) + 'px';
                        tooltip.style.top = (e.clientY + 15) + 'px';
                    };

                    // ë§ˆìš°ìŠ¤ ì´íƒˆ ì‹œ
                    info.el.onmouseleave = function() {
                        tooltip.classList.add('hidden');
                    };
                }
            });

            calendar.render();
            // ìº˜ë¦°ë” ì¸ìŠ¤í„´ìŠ¤ë¥¼ DOM ìš”ì†Œì— ì €ì¥
            calendarEl.calendar = calendar;
        }

        // --- NEW: Chart.js Rendering Function (Section 2 - Comparison) ---
        function renderComparisonChart() {
            const ctx = document.getElementById('teamComparisonChart');
            if (!ctx) return;
            
            // NEW: í˜„ì¬ íŒ€ ì´ë¦„ ì¶”ì¶œ (ë°ì´í„° ì •ë ¬ ê¸°ì¤€ê³¼ ë™ì¼)
            const pageTitle = document.title;
            const currentTeamMatch = pageTitle.match(/([ê°€-í£A-Z]+íŒ€)/);
            const currentTeamName = currentTeamMatch ? currentTeamMatch[1] : 'í’ˆì§ˆê²½ì˜íŒ€';
            const mainTeamKey = currentTeamName === 'í’ˆì§ˆê²½ì˜íŒ€' ? 'í’ˆì§ˆê²½ì˜íŒ€ (FPCB)' : currentTeamName; 
            
            const teamLabels = TEAM_MASTER_DATA.map(d => d.team);
            const teamAchieved = TEAM_MASTER_DATA.map(d => d.achievedRate.toFixed(1));
            const teamColors = TEAM_MASTER_DATA.map(d => d.color);
            
            // MODIFIED: 'êµ¬ë¶„ ì¥ì¹˜' (Highlighting main team's border)
            const teamBorderWidths = TEAM_MASTER_DATA.map(d => 
                d.team === mainTeamKey ? 3 : 1
            );
            const teamBorderColors = TEAM_MASTER_DATA.map(d => 
                d.team === mainTeamKey ? '#2563EB' : (d.color + 'AA') // Darker blue border for main team
            );

            // ê¸°ì¡´ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©´ íŒŒê´´
            if (ctx.chart) {
                ctx.chart.destroy();
            }

            ctx.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teamLabels,
                    datasets: [{
                        label: 'ë‹¬ì„±ë¥  (%)',
                        data: teamAchieved,
                        backgroundColor: teamColors,
                        borderColor: teamBorderColors, 
                        borderWidth: teamBorderWidths, 
                        borderRadius: 6 
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Horizontal bar chart (Y: Team, X: Rate)
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '2025ë…„ êµìœ¡ ëª©í‘œ ë‹¬ì„±ë¥  ë¹„êµ',
                            font: { size: 14, weight: 'bold' } 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += context.parsed.x.toFixed(1) + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'ë‹¬ì„±ë¥  (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                display: false 
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            // MODIFIED: Yì¶• ë ˆì´ë¸” ê°•ì¡°
                            ticks: {
                                callback: function(value, index, ticks) {
                                    const label = this.getLabelForValue(value);
                                    return label;
                                },
                                font: function(context) {
                                    return context.tick.label === mainTeamKey ? { weight: 'bold' } : {};
                                }
                            }
                        }
                    }
                }
            });
        }
        // -----------------

        // --- NEW: ì¼ì • ì¶”ê°€ ëª¨ë‹¬ í•¨ìˆ˜ ---
        function openAddScheduleModal() {
            document.getElementById('validationMessage').textContent = '';
            document.getElementById('addScheduleModal').classList.remove('hidden');
        }

        function closeAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.add('hidden');
        }
        
        function saveNewSchedule() {
            const name = document.getElementById('newScheduleName').value.trim();
            const start = document.getElementById('newScheduleStart').value.trim();
            const end = document.getElementById('newScheduleEnd').value.trim();
            const type = document.getElementById('newScheduleType').value.trim();
            const messageElement = document.getElementById('validationMessage');

            if (!name || !start || !end) {
                messageElement.textContent = "â— ê³¼ì •ëª…, ì‹œì‘ì¼, ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
                messageElement.classList.remove('hidden');
                return;
            }
            
            // Mock Data Update Logic
            const newId = 't' + (IN_PROGRESS_TRAININGS.length + 1);
            const newDuration = `${start.replace(/-/g, '.') || 'ë¯¸ì •'}~${end.replace(/-/g, '.') || 'ë¯¸ì •'}`;
            
            const newTraining = {
                id: newId, 
                name: name, 
                duration: newDuration, 
                attendees: ['[ìƒˆë¡œ ë“±ë¡]'], 
                type: type, 
                cost: '0ì›', 
                // ì„ì‹œë¡œ ì˜¨ë¼ì¸ í˜•íƒœë¥¼ ê°€ì •
                format: 'ì˜¨ë¼ì¸', 
                appliedDate: new Date().toISOString().split('T')[0]
            };

            IN_PROGRESS_TRAININGS.push(newTraining);
            IN_PROGRESS_DETAILS_MAP[newId] = { 'ê³¼ì •ëª…': name, 'ë‚´ìš©': 'ìƒˆë¡œ ì¶”ê°€ëœ êµìœ¡', 'ëª©ì ': 'ì‹ ê·œ ê³¼ì • ë“±ë¡', 'ê¸°ëŒ€íš¨ê³¼': 'ë¯¸ì •', 'êµìœ¡ìš”ì•½': 'ë¯¸ì •', 'ì—…ë¬´ì ìš©ê³„íš': 'ë¯¸ì •', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­': 'ë¯¸ì •', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì ': 'ë¯¸ì •' };
            
            // Close modal and re-render calendar/list
            closeAddScheduleModal();
            renderCalendar(); 
            updateInProgressCount(); // êµìœ¡ ê±´ìˆ˜ ì—…ë°ì´íŠ¸
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('newScheduleName').value = '';
            document.getElementById('newScheduleStart').value = '';
            document.getElementById('newScheduleEnd').value = '';
        }
        // -----------------
        
        // --- NEW: íŒ€ë³„ ìƒì„¸ ëª©í‘œ ëª¨ë‹¬ í•¨ìˆ˜ ---
        function openTeamGoalsModal() {
            const modal = document.getElementById('teamGoalsModal');
            const body = document.getElementById('teamGoalsBody');
            body.innerHTML = ''; // Clear previous content

            // TEAM_MASTER_DATAë¥¼ ì‚¬ìš©
            const teams = [...TEAM_MASTER_DATA].reverse(); 
            
            teams.forEach(teamData => {
                const goals = teamData.goals;
                const color = teamData.color; 

                let goalHtml = goals.map(goal => 
                    `<li class="text-sm text-gray-700">â–ªï¸ ${goal.name} (${goal.targetHours.toFixed(0)}ì‹œê°„)</li>`
                ).join('');

                const section = document.createElement('div');
                section.className = 'p-3 rounded-lg border bg-gray-50';
                section.style.borderColor = color; // Use team color for border
                
                section.innerHTML = `
                    <h4 class="text-base font-bold" style="color: ${color};">${teamData.team}</h4>
                    <ul class="mt-2 space-y-1">${goalHtml}</ul>
                `;
                body.appendChild(section);
            });

            modal.classList.remove('hidden');
        }

        function closeTeamGoalsModal() {
            document.getElementById('teamGoalsModal').classList.add('hidden');
        }
        
        // --- NEW: íŒ€ë³„ êµìœ¡ ëª©í‘œ ë‚´ì—­ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderDetailedTeamGoals() {
            const container = document.getElementById('detailedTeamGoalsContainer');
            if (!container) return;

            // TEAM_MASTER_DATAë¥¼ ì‚¬ìš©
            let goalsHtml = TEAM_MASTER_DATA.map(teamData => {
                const goalItemsHtml = teamData.goals.map((item, index) => {
                    return `
                        <div class="flex justify-between text-sm py-0.5">
                            <span class="text-gray-800 w-2/3 truncate">${index + 1}. ${item.name}</span>
                            <span class="text-blue-600 font-semibold w-1/3 text-right">${item.targetHours.toFixed(0)} ì‹œê°„</span>
                        </div>
                    `;
                }).join('');

                const teamColor = teamData.color;
                
                return `
                    <div class="goal-card p-4 rounded-xl border-2 shadow-md bg-white hover:shadow-lg transition duration-200" style="border-color: ${teamColor};">
                        <!-- MODIFIED: memberCount ì¶”ê°€ -->
                        <div class="flex justify-between items-start mb-2 border-b pb-2">
                            <h4 class="text-lg font-bold" style="color: ${teamColor};">${teamData.team.replace(' (FPCB)', '')} ëª©í‘œ (${teamData.memberCount}ëª…)</h4>
                            <span class="text-xs text-gray-600">ì‹¤ì : <span class="font-bold text-gray-800">${teamData.totalAchievedTime.toFixed(1)}h</span></span>
                        </div>
                        
                        <h5 class="text-sm font-bold text-gray-800 mb-1">ì„¸ë¶€ ëª©í‘œ</h5>
                        ${goalItemsHtml}
                    </div>
                `;
            }).join('');

            container.innerHTML = goalsHtml;
        }

        // --- í† ê¸€ ê¸°ëŠ¥ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function toggleInProgressList() {
            const elementId = 'expandedInProgressList';
            const trainingListBody = document.getElementById('inProgressListBody');
            const inProgressTitleList = document.getElementById('inProgressTitleList');
            const isHidden = document.getElementById(elementId).classList.contains('hidden');
            
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.evaluation-menu').forEach(menu => menu.classList.add('hidden')); 
            
            // ë‹¤ë¥¸ í¼ì¹¨ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const expandedNonCompletersList = document.getElementById('expandedNonCompletersList');
            if (expandedNonCompletersList && !expandedNonCompletersList.classList.contains('hidden') && elementId !== 'expandedNonCompletersList') {
                expandedNonCompletersList.classList.add('hidden');
            }
            
            if (isHidden) {
                // NEW: ì¢…ë£Œì¼(due date) ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                const sortedTrainings = [...IN_PROGRESS_TRAININGS].sort((a, b) => {
                    const endA = a.duration.split('~')[1].trim().replace(/\./g, '-');
                    const endB = b.duration.split('~')[1].trim().replace(/\./g, '-');
                    return endA.localeCompare(endB); // Due dateê°€ ê°€ê¹Œìš´ ìˆœ (ì˜¤ë¦„ì°¨ìˆœ)
                });
                
                trainingListBody.innerHTML = '';
                const titles = sortedTrainings.map(t => t.name).join(', ');
                if (inProgressTitleList) {
                    inProgressTitleList.textContent = titles;
                }
                
                sortedTrainings.forEach(training => {
                    const item = document.createElement('div');
                    item.className = 'p-4 border border-gray-200 rounded-lg bg-green-50 hover:bg-green-100 transition mb-3 last:mb-0 cursor-pointer';
                    item.setAttribute('onclick', `openInProgressTrainingModal('${training.id}')`);

                    item.innerHTML = `
                        <p class="text-base font-bold text-green-700">${training.name}</p>
                        <p class="text-sm text-gray-600 mt-1">ê¸°ê°„: ${training.duration} (${training.type}) | ë¹„ìš©: ${training.cost}</p>
                        <p class="text-sm text-gray-700 mt-2 font-medium">êµìœ¡ í˜•íƒœ: ${training.format} | ì°¸ì—¬ ì¸ì›: ${training.attendees.join(', ')}</p>
                    `;
                    trainingListBody.appendChild(item);
                });
            } else {
                 if (inProgressTitleList) inProgressTitleList.textContent = ''; // ë‹«ì„ ë•Œ ì œëª© ìˆ¨ê¹€
            }
            document.getElementById(elementId).classList.toggle('hidden');
        }

        // NEW: ì˜ë¬´êµìœ¡ ë¯¸ì´ìˆ˜ì ëª©ë¡ í† ê¸€ í•¨ìˆ˜
        function toggleNonCompletersList() {
            const elementId = 'expandedNonCompletersList';
            
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.evaluation-menu').forEach(menu => menu.classList.add('hidden')); 
            
            // ë‹¤ë¥¸ í¼ì¹¨ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const expandedInProgressList = document.getElementById('expandedInProgressList');
            if (expandedInProgressList && !expandedInProgressList.classList.contains('hidden') && elementId !== 'expandedInProgressList') {
                expandedInProgressList.classList.add('hidden');
            }
            
            document.getElementById(elementId).classList.toggle('hidden');
        }


        function openInProgressTrainingModal(id) {
            const detail = IN_PROGRESS_DETAILS_MAP[id];
            const training = IN_PROGRESS_TRAININGS.find(t => t.id === id);
            const modal = document.getElementById('inProgressTrainingModal');
            
            if (!detail || !training) {
                console.error("ìƒì„¸ êµìœ¡ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            const titleElement = document.getElementById('inProgressModalTitle');
            const fieldsContainer = document.getElementById('trainingModalReportFields');
            
            titleElement.textContent = `[${training.format}] ${detail['ê³¼ì •ëª…']}`; 
            fieldsContainer.innerHTML = ''; 

            const fields = ['ê³¼ì •ëª…', 'ë‚´ìš©', 'ëª©ì ', 'ê¸°ëŒ€íš¨ê³¼', 'êµìœ¡ìš”ì•½', 'ì—…ë¬´ì ìš©ê³„íš', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì '];
            
            fields.forEach(field => {
                const value = detail[field] || 'ë‚´ìš© ë¯¸ë“±ë¡';
                const item = document.createElement('div');
                item.className = 'border-b border-gray-200 pb-3';
                item.innerHTML = `
                    <h4 class="text-sm font-bold text-gray-700 mb-1">${field}</h4>
                    <p class="text-sm text-gray-600 bg-gray-50 p-2 rounded whitespace-pre-wrap">${value}</p>
                `;
                fieldsContainer.appendChild(item);
            });

            modal.classList.remove('hidden');
        }

        function closeInProgressTrainingModal() {
            document.getElementById('inProgressTrainingModal').classList.add('hidden');
        }
        
        function openEducationDetailModal(id) {
            const item = ALL_EDUCATIONS_MASTER.find(e => e.id === id);
            const modal = document.getElementById('educationDetailModal');
            
            if (!item) {
                console.error("êµìœ¡ ì´ë ¥ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            const contentBody = document.getElementById('educationDetailBody');
            const report = EDUCATION_REPORT_MAP[id] || {}; 
            
            const fields = ['ë‚´ìš©', 'ëª©ì ', 'ê¸°ëŒ€íš¨ê³¼', 'êµìœ¡ìš”ì•½', 'ì—…ë¬´ì ìš©ê³„íš', 'ì—…ë¬´ì ìš© ì• ë¡œì‚¬í•­', 'ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì '];

            let reportHtml = `
                <div class="space-y-4 pt-2">
                    <h4 class="text-lg font-bold text-blue-700 border-b pb-2 mb-3">${item.name}</h4>
                    <p class="text-sm text-gray-600 mb-4">${item.empName} / ${item.dept}</p> 
            `;
            
            fields.forEach(field => {
                const value = report[field] || 'ë‚´ìš© ë¯¸ë“±ë¡';
                reportHtml += `
                    <div class="pb-3 last:border-b-0">
                        <span class="font-bold text-gray-700 block text-xs mb-1">${field}</span>
                        <p class="text-sm text-gray-800 bg-gray-100 p-2 mt-1 rounded whitespace-pre-wrap">${value}</p>
                    </div>
                `;
            });

            reportHtml += `</div>`;
            
            contentBody.innerHTML = reportHtml;
            modal.classList.remove('hidden');
        }

        function closeEducationDetailModal() {
            document.getElementById('educationDetailModal').classList.add('hidden');
        }

        
        function openMemberDetailModal(memberId) {
            const member = FPCB_MEMBERS.find(m => m.id === memberId); 
            
            if (!member) {
                console.error(`Member not found for ID: ${memberId}`);
                return; 
            }

            const modal = document.getElementById('memberDetailModal');
            document.getElementById('modalMemberName').textContent = `${member.name} (${member.id})`;
            
            const detailsBody = document.getElementById('modalMemberDetails');
            
            const MANDATORY_EXTERNAL_GOAL = 12.0;
            const numericTotalTime = getNumericTime(member.totalTime);
            const numericExternalTime = getNumericTime(member.externalTime);

            // 1. Total Goal Achievement
            const totalAchievementRate = member.goalTime && member.goalTime > 0 
                ? (numericTotalTime / member.goalTime) * 100 
                : 0;
            const totalRate = Math.min(100, totalAchievementRate).toFixed(1);
            const totalBarWidth = `${totalRate}%`;
            const totalGoalTime = member.goalTime ? member.goalTime.toFixed(1) : 'ë¯¸ì •';
            const totalRateDisplay = totalAchievementRate.toFixed(1);

            // 2. Mandatory External Goal Achievement
            const mandatoryAchievementRate = (numericExternalTime / MANDATORY_EXTERNAL_GOAL) * 100;
            const mandatoryRate = Math.min(100, mandatoryAchievementRate).toFixed(1); 
            const mandatoryBarWidth = `${mandatoryRate}%`;
            const mandatoryBarColor = mandatoryAchievementRate >= 100 ? 'bg-green-600' : 'bg-red-500';
            const mandatoryTextColor = mandatoryAchievementRate >= 100 ? 'text-green-700' : 'text-red-700';
            const mandatoryRateDisplay = mandatoryAchievementRate.toFixed(1);

            // 3. ê°œì¸ êµìœ¡ ê³„íš ëª©ë¡ (ì²´í¬ë¦¬ìŠ¤íŠ¸) 
            const MEMBER_PLANS = {
                '20220458': [ // ë°•ë™í˜
                    { name: 'ISO 9001 ì‹¬í™” ê³¼ì • ì´ìˆ˜', completed: true, isExternal: true }, 
                    { name: 'í’ˆì§ˆ ë°ì´í„° ë¶„ì„ ì „ë¬¸ê°€ ìê²©ì¦ ì·¨ë“', completed: false, isExternal: false }, 
                    { name: '5S í™œë™ ë¦¬ë” êµìœ¡', completed: true, isExternal: true } 
                ],
                '201920458': [ // ê¹€ë™í˜
                    { name: 'ì‚¬ë‚´ ì½”ë”© êµìœ¡ (Python)', completed: true, isExternal: false }, // ê¹€ë™í˜ì˜ ìƒˆë¡œìš´ ì´ìˆ˜ ê³¼ì •ì— ë§ì¶° ì„ì‹œ ì—…ë°ì´íŠ¸
                    { name: 'FPCB ê³µì • ê¸°ì´ˆ êµìœ¡', completed: false, isExternal: true }, 
                    { name: 'ìµœì‹  ë°˜ë„ì²´ ê³µì • ê¸°ìˆ  ì´í•´', completed: true, isExternal: true }
                ]
            };
            
            let checklistHtml = '';
            const plans = MEMBER_PLANS[member.id] || [];

            plans.forEach(plan => {
                const checkIcon = plan.completed 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-blue-600 flex-shrink-0"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.857a.75.75 0 00-1.214-.857l-3.333 3.333-1.666-1.666a.75.75 0 00-1.06 1.06l2.5 2.5a.75.75 0 001.06 0l4-4a.75.75 0 00.001-1.06z" clip-rule="evenodd" /></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400 flex-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>`;
                const planTypeTag = plan.isExternal ? 
                    `<span class="text-[10px] font-bold text-red-700 bg-red-100 px-1 py-0.5 rounded-full ml-1">ì‚¬ì™¸êµìœ¡</span>` : 
                    `<span class="text-[10px] font-bold text-gray-700 bg-gray-100 px-1 py-0.5 rounded-full ml-1">ìƒì‹œí•™ìŠµ</span>`;

                checklistHtml += `
                    <div class="flex items-start space-x-2 py-1.5 border-b border-gray-100 last:border-b-0">
                        ${checkIcon}
                        <div class="flex-1 min-w-0">
                            <span class="text-sm ${plan.completed ? 'text-gray-700 line-through' : 'text-gray-900 font-medium'} truncate">${plan.name}</span>
                            ${planTypeTag}
                        </div>
                    </div>
                `;
            });
            if (plans.length === 0) {
                 checklistHtml = '<p class="text-sm text-gray-500 p-2 text-center">ê°œì¸ êµìœ¡ ê³„íšì„œì— ë“±ë¡ëœ ê³„íšì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            // 5. ê³„íší•˜ì§€ ì•Šì•˜ì§€ë§Œ ë“¤ì—ˆë˜ êµìœ¡ (ê³„íšì— ì—†ê³  ì´ìˆ˜í•œ êµìœ¡)
            const getUnplannedEducations = (memberId, memberEducations, memberPlans) => {
                const memberPlanNames = new Set((memberPlans[memberId] || []).map(p => p.name.trim().toLowerCase()));
                return memberEducations.filter(edu => {
                    if (edu.status !== 'ì´ìˆ˜ì™„ë£Œ') return false; 
                    return !memberPlanNames.has(edu.name.trim().toLowerCase());
                });
            };
            const unplannedEducations = getUnplannedEducations(member.id, ALL_EDUCATIONS_MASTER, MEMBER_PLANS);
            let unplannedHtml = ''; 

            if (unplannedEducations.length > 0) {
                unplannedHtml = unplannedEducations.map(edu => `
                    <div class="p-2 border-b border-gray-200 last:border-b-0">
                        <p class="text-sm font-semibold text-gray-800">${edu.name}</p>
                        <p class="text-xs text-gray-600 mt-1">ê¸°ê°„: ${edu.period} (${edu.source}) | ì¸ì •: ${edu.hours.toFixed(1)} ì‹œê°„</p>
                    </div>`
                ).join('');                
            } else {
                 unplannedHtml = '<p class="text-sm text-gray-500 p-2 text-center">ê³„íš ì™¸ ì´ìˆ˜ êµìœ¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }


            // ìµœì¢… ëª¨ë‹¬ ë‚´ìš© êµ¬ì„±
            detailsBody.innerHTML = `
                <!-- 1. ì´ êµìœ¡ ëª©í‘œ ë‹¬ì„± í˜„í™© (ê³„íš ê¸°ì¤€) -->
                <div class="space-y-3 p-3 bg-indigo-50 rounded-lg">
                    <p class="text-base font-bold text-indigo-700">ì´ êµìœ¡ ëª©í‘œ ë‹¬ì„± í˜„í™© (ê³„íš: ${totalGoalTime} ì‹œê°„)</p>
                    <div class="text-sm">
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold text-gray-700">ì´ ì´ìˆ˜ ì‹œê°„: ${member.totalTime}</span>
                            <span class="font-extrabold text-indigo-800">${totalRateDisplay}%</span>
                        </div>
                        <div class="w-full bg-indigo-200 rounded-full h-3">
                            <div class="bg-indigo-600 h-3 rounded-full transition-all duration-500" style="width: ${totalBarWidth}"></div>
                        </div>
                    </div>
                </div>

                <!-- 2. ì˜ë¬´ ì‚¬ì™¸ êµìœ¡ ë‹¬ì„± í˜„í™© (12.0 ì‹œê°„ ê¸°ì¤€) -->
                <div class="space-y-3 p-3 bg-red-50 rounded-lg">
                    <p class="text-base font-bold text-red-700">ì˜ë¬´ ì‚¬ì™¸ êµìœ¡ ë‹¬ì„± í˜„í™© (ëª©í‘œ: ${MANDATORY_EXTERNAL_GOAL.toFixed(1)} ì‹œê°„)</p>
                    <div class="text-sm">
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold text-gray-700">ì‚¬ì™¸ ì´ìˆ˜ ì‹œê°„: ${member.externalTime}</span>
                            <span class="font-extrabold ${mandatoryTextColor}">${mandatoryRateDisplay}%</span>
                        </div>
                        <div class="w-full bg-red-200 rounded-full h-3">
                            <div class="${mandatoryBarColor} h-3 rounded-full transition-all duration-500" style="width: ${mandatoryBarWidth}"></div>
                        </div>
                    </div>
                </div>

                <!-- 3. ê°œì¸ êµìœ¡ ê³„íš ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                <div class="pt-4 mt-4 space-y-3 p-3 bg-gray-100 rounded-lg border border-gray-200">
                    <p class="text-base font-bold text-gray-800 border-b pb-2">ê°œì¸ êµìœ¡ ê³„íš</p>
                    <div class="max-h-32 overflow-y-auto pr-2">
                        ${checklistHtml}
                    </div>
                </div>
                
                <!-- 4. ê³„íší•˜ì§€ ì•Šì•˜ì§€ë§Œ ë“¤ì—ˆë˜ êµìœ¡ ëª©ë¡ -->
                <div class="pt-4 space-y-3 p-3 bg-gray-100 rounded-lg border border-gray-200">
                    <p class="text-base font-bold text-gray-800 border-b pb-2">ì¶”ê°€ ì´ìˆ˜ êµìœ¡</p> 
                    <div class="max-h-32 overflow-y-auto pr-2">
                            ${unplannedHtml}
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        function closeMemberDetailModal() {
            document.getElementById('memberDetailModal').classList.add('hidden');
        }
        // --- ì¸ì› í˜„í™© íŒì—… í•¨ìˆ˜ ë ---

        // --- í•„í„°ë§ ë° ë Œë”ë§ ë¡œì§ (ê¸°ì¡´) ---

        function renderEducationList(data) {
            const listContainer = document.getElementById('filteredEducationList');
            if (data.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-gray-500 p-4">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” êµìœ¡ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            listContainer.innerHTML = data.map(item => {
                const statusColor = item.status === 'ì´ìˆ˜ì™„ë£Œ' ? 'text-green-500' : 'text-red-500';
                const costDisplay = item.cost > 0 ? formatCurrency(item.cost) : 'â‚©0';
                const refundStatus = item.refundable === 'O' ? 'O' : 'X';
                
                const educationOrganizer = item.source === 'ì‚¬ì™¸' ? 'ì™¸ë¶€ ê¸°ê´€' : 'ì‚¬ë‚´ ìƒì‹œ í•™ìŠµ';
                
                return `
                    <div class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition cursor-pointer" onclick="openEducationDetailModal('${item.id}')">
                        <div class="flex justify-between items-start mb-2">
                            <div class="space-y-1">
                                <p class="text-lg font-bold text-gray-800">${item.name}</p>
                                <p class="text-sm font-semibold text-blue-600">${item.empName} / ${item.dept}</p>
                            </div>
                            <span class="text-xs text-blue-600 font-semibold bg-blue-100 px-2 py-1 rounded-full">${educationOrganizer}</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-700 border-t pt-2 mt-2">
                            <p>ê¸°ê°„: <span class="font-semibold">${item.period}</span></p>
                            <p>ìƒíƒœ: <span class="font-semibold ${statusColor}">${item.status}</span></p>
                            <p>í˜•íƒœ: <span class="font-semibold">${item.type}</span></p>
                            <p>êµìœ¡ì£¼ê´€: <span class="font-semibold">${educationOrganizer}</span></p>
                            <p>ì¸ì •ì‹œê°„: <span class="font-semibold text-blue-500">${item.hours.toFixed(1)} ì‹œê°„</span></p>
                            <p>ë¹„ìš©: <span class="font-semibold">${costDisplay}</span></p>
                            <p>í™˜ê¸‰ì—¬ë¶€: <span class="font-semibold">${refundStatus}</span></p>
                            <p></p> <!-- 4ì—´ ë§ì¶¤ìš© ë¹ˆ ê³µê°„ -->
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterAndRenderEducationList() {
            const courseNameInput = document.getElementById('filterCourseName');
            const employeeSelect = document.getElementById('filterEmployeeNameSelect');
            const jobTitleSelect = document.getElementById('jobTitle');
            const statusTypeSelect = document.getElementById('statusType');

            const courseNameValue = courseNameInput ? courseNameInput.value.trim().toLowerCase() : '';
            const employeeIdValue = employeeSelect ? employeeSelect.value : '';
            const jobTitleValue = jobTitleSelect ? jobTitleSelect.value : '';
            const statusTypeValue = statusTypeSelect ? statusTypeSelect.value : '';

            let filtered = ALL_EDUCATIONS_FILTERABLE;
            
            // 1. Course Name Filter
            if (courseNameValue) {
                filtered = filtered.filter(item => item.name.toLowerCase().includes(courseNameValue));
            }

            // 2. Employee Filter (by ID)
            if (employeeIdValue) {
                filtered = filtered.filter(item => item.empId === employeeIdValue);
            }

            // 3. Job Title Filter (Placeholder logic since jobTitle isn't in ALL_EDUCATIONS_MASTER mock data)
            if (jobTitleValue && jobTitleValue !== 'ì „ì²´ ì§ì±…') {
                // Filtering skipped for now.
            }

            // 4. Status Filter
            if (statusTypeValue) {
                filtered = filtered.filter(item => item.status === statusTypeValue);
            }

            renderEducationList(filtered);
        }

        function clearFiltersAndRender() {
            const courseNameInput = document.getElementById('filterCourseName');
            const employeeSelect = document.getElementById('filterEmployeeNameSelect');
            const jobTitleSelect = document.getElementById('jobTitle');
            const statusTypeSelect = document.getElementById('statusType');

            if (courseNameInput) courseNameInput.value = '';
            if (employeeSelect) employeeSelect.value = '';
            if (jobTitleSelect) jobTitleSelect.value = '';
            if (statusTypeSelect) statusTypeSelect.value = '';

            renderEducationList(ALL_EDUCATIONS_FILTERABLE);
        }

        function populateEmployeeFilter() {
            const select = document.getElementById('filterEmployeeNameSelect');
            if (!select) return;
            select.innerHTML = '<option value="">ì „ì²´ ì¸ì›</option>'; 
            FPCB_MEMBERS.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.id})`;
                select.appendChild(option);
            });
        }
        
        // --- NEW: í‰ê°€ ë“œë¡­ë‹¤ìš´ í† ê¸€ ë° ì„ íƒ í•¨ìˆ˜ ---
        function toggleEvaluationDropdown(event, memberId, eduId) {
            event.stopPropagation(); 
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.evaluation-menu').forEach(menu => {
                if (menu.id !== `menu-${memberId}-${eduId}`) {
                    menu.classList.add('hidden');
                }
            });

            const menu = document.getElementById(`menu-${memberId}-${eduId}`);
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        function selectEvaluation(memberId, eduId, value) {
            // Mock Data ì—…ë°ì´íŠ¸ (ì‹¤ì œ DBëŠ” ì•„ë‹˜)
            const edu = ALL_EDUCATIONS_MASTER.find(e => e.id === eduId && e.empId === memberId);
            if (edu) {
                edu.evaluation = value;
            }
            
            // UI ì—…ë°ì´íŠ¸
            renderApplicationTiming();
            
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.evaluation-menu').forEach(menu => menu.classList.add('hidden'));
        }

        // --- MODIFIED: ì˜ˆìƒ ì—…ë¬´ ì ìš© ë°œí˜„ ì‹œì  ë Œë”ë§ í•¨ìˆ˜ ---
        function renderApplicationTiming() {
            const container = document.getElementById('applicationTimingList');
            if (!container) return;
            
            let listHtml = '';

            // --- ì—…ë¬´ ì ìš© í‰ê°€ íƒœê·¸ í—¬í¼ í•¨ìˆ˜ (í´ë¦­ ê°€ëŠ¥ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½) ---
            const getEvaluationDropdown = (memberId, eduId, evaluation) => {
                let colorClass = 'bg-gray-200 text-gray-700';
                if (evaluation === 'ìƒ') colorClass = 'bg-green-100 text-green-700 font-extrabold';
                else if (evaluation === 'ì¤‘') colorClass = 'bg-yellow-100 text-yellow-700 font-bold';
                else if (evaluation === 'í•˜') colorClass = 'bg-red-100 text-red-700 font-bold';
                
                // MODIFIED: ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½ (í…Œë‘ë¦¬, ê·¸ë¦¼ì, ë°°ê²½ìƒ‰, ë“œë¡­ë‹¤ìš´ ì•„ì´ì½˜ ì¶”ê°€)
                return `
                    <div class="evaluation-dropdown w-full flex justify-end">
                        <button onclick="toggleEvaluationDropdown(event, '${memberId}', '${eduId}')" class="flex items-center justify-between text-sm px-2 py-1 rounded-lg ${colorClass} bg-gray-100 border border-gray-300 shadow-sm hover:bg-gray-200 transition duration-100 min-w-[80px] text-center">
                            <span class="flex-1">${evaluation}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 ml-1 flex-shrink-0 text-gray-500">
                                <path fill-rule="evenodd" d="M5.234 7.234A2 2 0 017 6h6a2 2 0 011.766 1.234l.234.352c.321.482.492 1.054.492 1.63V15a2 2 0 01-2 2H6a2 2 0 01-2-2v-5.784c0-.576.171-1.148.492-1.63L5.234 7.234z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="menu-${memberId}-${eduId}" class="evaluation-menu hidden bg-white border border-gray-300 rounded-lg overflow-hidden">
                            <!-- MODIFIED: ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í•­ëª©ì— ì‹œê°ì  êµ¬ë¶„ ì¶”ê°€ -->
                            <button onclick="selectEvaluation('${memberId}', '${eduId}', 'ìƒ')" class="block w-full text-left px-3 py-1 text-sm hover:bg-gray-200 bg-green-50 text-green-700 font-bold border-b border-gray-100">ìƒ</button>
                            <button onclick="selectEvaluation('${memberId}', '${eduId}', 'ì¤‘')" class="block w-full text-left px-3 py-1 text-sm hover:bg-gray-200 bg-yellow-50 text-yellow-700 font-bold border-b border-gray-100">ì¤‘</button>
                            <button onclick="selectEvaluation('${memberId}', '${eduId}', 'í•˜')" class="block w-full text-left px-3 py-1 text-sm hover:bg-gray-200 bg-red-50 text-red-700 font-bold border-b border-gray-100">í•˜</button>
                            <button onclick="selectEvaluation('${memberId}', '${eduId}', 'ë¯¸í‰ê°€')" class="block w-full text-left px-3 py-1 text-sm hover:bg-gray-200 text-gray-600">ë¯¸í‰ê°€</button>
                        </div>
                    </div>
                `;
            };

            // FPCB_MEMBERS ìˆœíšŒ
            FPCB_MEMBERS.forEach(member => {
                // 2025ë…„ ì´ìˆ˜ ì™„ë£Œëœ êµìœ¡ë§Œ í•„í„°ë§ (ìš”ì²­ ì‚¬í•­ ìœ ì§€)
                const completedList = ALL_EDUCATIONS_MASTER.filter(edu => 
                    edu.empId === member.id && 
                    edu.period.includes('2025') && 
                    edu.status === 'ì´ìˆ˜ì™„ë£Œ'
                );
                
                const allRelevantEducations = completedList.sort((a, b) => {
                    // ì˜ˆìƒ ì ìš© ì‹œì ìœ¼ë¡œ ì •ë ¬ (ì‹¤ì œ ë‚ ì§œëŠ” report mapì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
                    const timingA = EDUCATION_REPORT_MAP[a.id]?.['ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì '] || 'ë¯¸ë“±ë¡';
                    const timingB = EDUCATION_REPORT_MAP[b.id]?.['ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì '] || 'ë¯¸ë“±ë¡';
                    
                    if (timingA === 'ë¯¸ë“±ë¡' && timingB !== 'ë¯¸ë“±ë¡') return 1;
                    if (timingA !== 'ë¯¸ë“±ë¡' && timingB === 'ë¯¸ë“±ë¡') return -1;
                    return timingA.localeCompare(timingB);
                });
                
                // êµìœ¡ ëª©ë¡ HTML ìƒì„±
                let educationItemsHtml = '';
                if (allRelevantEducations.length > 0) {
                    educationItemsHtml = allRelevantEducations.map(edu => {
                        const timing = EDUCATION_REPORT_MAP[edu.id]?.['ì˜ˆìƒ ì—…ë¬´ì ìš© ë°œí˜„ì‹œì '] || 'ë¯¸ë“±ë¡';
                        const content = EDUCATION_REPORT_MAP[edu.id]?.['ë‚´ìš©'] || 'ìƒì„¸ ë‚´ìš© ë¯¸ë“±ë¡';
                        const timingDisplay = timing.match(/^\d{4}-\d{2}-\d{2}$/) ? timing : 'ë¯¸ë“±ë¡'; // YYYY-MM-DD í˜•ì‹ë§Œ í‘œì‹œ

                        return `
                            <div class="flex justify-between items-start py-1 border-b border-gray-100 last:border-b-0">
                                <!-- ì¢Œ: ê³¼ì •ëª… (W-2/12) - í•œ ì¤„ë¡œ ê³ ì • í•´ì œ. ë‚´ìš©ì´ ê¸¸ë©´ ì¤„ë°”ê¿ˆ -->
                                <span class="text-sm text-gray-700 font-medium w-2/12 pr-1">
                                    <span class="text-xs font-bold text-green-700 mr-1">[ì™„ë£Œ]</span>
                                    ${edu.name}
                                </span>

                                <!-- ì¤‘-ì¢Œ: ë‚´ìš© (W-6/12) - ì¤„ë°”ê¿ˆ í—ˆìš© -->
                                <span class="text-sm text-gray-600 w-6/12 pr-2">
                                    ${content}
                                </span>
                                
                                <!-- ì¤‘-ìš°: ì˜ˆìƒ ì—…ë¬´ ì ìš© ì‹œì  (W-2/12) -->
                                <span class="text-sm ${timingDisplay === 'ë¯¸ë“±ë¡' ? 'text-red-500 font-semibold' : 'text-indigo-600 font-bold'} w-2/12 text-center flex-shrink-0">
                                    ${timingDisplay}
                                </span>
                                
                                <!-- ìš°: ì—…ë¬´ ì ìš© í‰ê°€ (W-2/12) -->
                                <span class="w-2/12 flex justify-end flex-shrink-0">
                                    ${getEvaluationDropdown(member.id, edu.id, edu.evaluation || 'ë¯¸í‰ê°€')}
                                </span>
                            </div>
                        `;
                    }).join('');
                } else {
                    educationItemsHtml = '<p class="text-sm text-gray-500 py-2 text-center">ê¸ˆë…„ë„ì— ì´ìˆ˜ ì™„ë£Œëœ êµìœ¡ì´ ì—†ì–´ ì˜ˆìƒ ì ìš© ì‹œì ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

                listHtml += `
                    <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm col-span-1">
                        <p class="text-lg font-bold text-blue-700 mb-3">${member.name} (${member.id})</p>
                        <div class="space-y-1">
                            ${educationItemsHtml}
                        </div>
                    </div>
                `;
            });
            
            // NOTE: h3 íƒœê·¸ì™€ ê·¸ ì•„ë˜ì˜ ì—¬ë°±ì´ ì œê±°ë˜ê³ , í—¤ë” í–‰ì˜ paddingTop/Marginì´ ì¡°ì •ë¨.
            container.innerHTML = `
                <!-- NEW: Header Row -->
                <div class="flex justify-between items-center px-4 pt-1 pb-2 font-bold text-xs text-gray-600 border-b border-gray-300 bg-gray-50 rounded-t-lg">
                    <span class="w-2/12">ê³¼ì •ëª…</span>
                    <span class="w-6/12">ë‚´ìš©</span>
                    <span class="w-2/12 text-center">ì˜ˆìƒ ì—…ë¬´ ì ìš© ì‹œì </span>
                    <span class="w-2/12 text-right pr-2">í‰ê°€</span>
                </div>
                <!-- Data Rows -->
                <div class="space-y-4">
                    ${listHtml}
                </div>
            `;
            container.classList.remove('md:grid-cols-2');
            container.classList.add('grid-cols-1');
        }
        
        // --- NEW: ë¯¸ì´ìˆ˜ì ë Œë”ë§ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function renderNonCompleters() {
            // Note: ì´ í•¨ìˆ˜ëŠ” expandedNonCompletersListì— ë‚´ìš©ì„ ì£¼ì…í•˜ê³  nonCompletersListë¥¼ ë¹„ìš°ë„ë¡ ì„¤ê³„ë¨.
            const container = document.getElementById('expandedNonCompletersList');
            const summaryContainer = document.getElementById('nonCompletersCount'); // MODIFIED: ì¹´ìš´íŠ¸ ID ì‚¬ìš©
            if (!container || !summaryContainer) return;
            
            const NON_COMPLETERS = FPCB_MEMBERS.map(member => {
                const numericTotalTime = getNumericTime(member.totalTime);
                const isGoalMet = numericTotalTime >= member.goalTime;
                return {
                    name: member.name,
                    id: member.id,
                    goal: member.goalTime,
                    achieved: numericTotalTime,
                    isMet: isGoalMet
                };
            }).filter(member => !member.isMet); 

            // MODIFIED: ìš”ì•½ í…ìŠ¤íŠ¸ ëŒ€ì‹  ë¯¸ë‹¬ì„± ì¸ì›ìˆ˜ë§Œ ì£¼ì…
            summaryContainer.textContent = NON_COMPLETERS.length; 

            if (NON_COMPLETERS.length === 0) {
                 container.innerHTML = '<p class="text-center text-green-500 p-4 font-semibold">ëª¨ë“  íŒ€ì›ì´ êµìœ¡ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!</p>';
                 return;
            }

            let listHtml = NON_COMPLETERS.map(member => {
                const neededHours = (member.goal - member.achieved).toFixed(1);
                const progress = (member.achieved / member.goal) * 100;
                const progressBarWidth = `${Math.min(99, progress)}%`; 

                return `
                    <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                        <p class="text-lg font-bold text-red-700">${member.name} (${member.id})</p>
                        <p class="text-sm text-gray-600 mt-1">ëª©í‘œ: ${member.goal.toFixed(1)}ì‹œê°„ | í˜„ì¬: ${member.achieved.toFixed(1)}ì‹œê°„</p>
                        <p class="text-sm font-extrabold text-red-600 mt-2">í•„ìš” ì‹œê°„: ${neededHours} ì‹œê°„</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                            <div class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: ${progressBarWidth}"></div>
                        </div>
                        <span class="text-xs text-red-500 mt-1 block text-right">${progress.toFixed(1)}% ë‹¬ì„±</span>
                    </div>
                `;
            }).join('');
            
            // í† ê¸€ ëª©ë¡ì— ë‚´ìš© ì£¼ì…
            container.innerHTML = `<div class="space-y-4 p-4">${listHtml}</div>`;
        }

        // --- DOMContentLoaded ë¡œì§ ---
        document.addEventListener('DOMContentLoaded', () => {
            // NEW: ë°ì´í„° ì´ˆê¸°í™” ë° ê³„ì‚°
            initializeTeamData();

            // NEW: êµìœ¡ ê±´ìˆ˜ ì´ˆê¸° ì—…ë°ì´íŠ¸
            updateInProgressCount();
            
            // New Render Functions
            renderCalendar(); 
            renderComparisonChart(); 
            renderDetailedTeamGoals(); // NEW: ìƒì„¸ ëª©í‘œ ë Œë”ë§

            // Existing Render Functions
            populateEmployeeFilter();
            renderApplicationTiming(); // MODIFIED
            renderNonCompleters(); 
            filterAndRenderEducationList(); 

            // Attach event listeners
            document.getElementById('searchButton').addEventListener('click', filterAndRenderEducationList);
            document.getElementById('clearFiltersButton').addEventListener('click', clearFiltersAndRender);
            
            document.getElementById('memberDetailModal').addEventListener('click', (e) => {
                if (e.target.id === 'memberDetailModal') closeMemberDetailModal();
            });
            
            // ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ ì¼ì • ì„¹ì…˜ ì´ˆê¸°í™” ì‹œ ëª©ë¡ ì œëª©ë„ ì—…ë°ì´íŠ¸
            const inProgressTitleList = document.getElementById('inProgressTitleList');
            if (inProgressTitleList) {
                const titles = IN_PROGRESS_TRAININGS.map(t => t.name).join(', ');
                inProgressTitleList.textContent = titles;
            }

            // Global click listener to close dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                const dropdowns = document.querySelectorAll('.evaluation-menu');
                dropdowns.forEach(menu => {
                    if (!menu.classList.contains('hidden') && !menu.parentElement.contains(event.target)) {
                        menu.classList.add('hidden');
                    }
                });
            });
        });
        
    </script>

</head>
<body class="p-4 md:p-8">

<div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6 lg:p-10">

    <!-- Header/Title Section -->
    <header class="mb-8 border-b pb-4">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-4">FPCBì‚¬ì—…ë³¸ë¶€ í’ˆì§ˆê²½ì˜íŒ€ ëŒ€ì‹œë³´ë“œ</h1>
    </header>

    <div id="fpcb-content" class="content-section space-y-12">

        <!-- 1. ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ ì¼ì • (Calendar View Added) -->
        <h2 class="text-xl font-bold text-gray-700 mb-6">1. ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ ì¼ì •</h2>
        <div class="card bg-white p-6 border border-gray-200 space-y-4">
            
            <!-- Calendar Container: h-96 class removed for auto height/no scroll -->
            <div id="trainingCalendar" class="p-2 border border-gray-200 rounded-lg shadow-inner bg-gray-50">
                <!-- FullCalendar will be rendered here -->
            </div>

            <div class="flex justify-between items-center pt-4 border-t">
                <!-- MODIFIED: Title Change -->
                <h3 class="text-lg font-bold text-gray-800">
                    ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ (ì´ 
                    <span id="inProgressTrainingCount"></span>
                    ê±´)
                </h3>
                <button onclick="toggleInProgressList()" class="text-sm font-semibold text-green-600 hover:text-green-700 transition duration-150">
                    ìƒì„¸ ëª©ë¡ í¼ì¹˜ê¸°/ìˆ¨ê¸°ê¸°
                </button>
            </div>
            
            <!-- í¼ì³ì§€ëŠ” ìƒì„¸ ì •ë³´ ì˜ì—­ë“¤ (í˜„ì¬ ì§„í–‰ ì¤‘ì¸ êµìœ¡) -->
            <div id="expandedInProgressList" class="hidden mt-6 rounded-xl border border-green-200 shadow-inner">
                <div class="p-3 bg-green-100 rounded-t-xl">
                    <p class="text-sm font-bold text-green-800">ëª©ë¡: <span id="inProgressTitleList"></span></p>
                </div>
                <div id="inProgressListBody" class="p-4"></div>
            </div>
        </div>

        <!-- 2. ì¸ë ¥ í˜„í™© (íŒ€ì› í˜„í™© ë° íŒ€ë³„ ë¹„êµ ê·¸ë˜í”„ ì¶”ê°€) -->
        <!-- MODIFIED: Section 2 Title Change -->
        <h2 class="text-xl font-bold text-gray-700 mb-6">2. êµìœ¡ ì§„í–‰ì‚¬í•­</h2>
        <div class="card bg-white p-6 border border-gray-200 space-y-8">
            
            <!-- 2-1. íŒ€ë³„ êµìœ¡ ëª©í‘œ ë‹¬ì„±ë¥  ë¹„êµ (NEW) - MOVED UP -->
            <div>
                <!-- MODIFIED: Added button for team goals -->
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-lg font-bold text-gray-800">íŒ€ë³„ ì—°ê°„ êµìœ¡ ëª©í‘œ ë‹¬ì„±ë¥  ë¹„êµ</h3>
                    <button onclick="openTeamGoalsModal()" class="text-sm font-semibold text-blue-600 hover:text-blue-700 transition duration-150">
                        íŒ€ë³„ ìƒì„¸ ëª©í‘œ ë³´ê¸°
                    </button>
                </div>
                
                <!-- MODIFIED: Re-enabled graph with canvas, height changed to h-80 for 8 items -->
                <div class="p-2 bg-gray-50 rounded-lg border border-gray-200"> 
                    <canvas id="teamComparisonChart" class="h-80"></canvas>
                </div>
                <p class="text-xs text-gray-500 text-center mt-3">* ë‹¬ì„±ë¥ ì€ ì´ ëª©í‘œ ì‹œê°„ ëŒ€ë¹„ ì‹¤ì  ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- NEW SECTION: íŒ€ë³„ êµìœ¡ ëª©í‘œ ë‚´ì—­ (ì˜ˆì‹œ) -->
            <div>
                <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">íŒ€ë³„ êµìœ¡ ëª©í‘œ ë‚´ì—­ (ì˜ˆì‹œ)</h3>
                <div id="detailedTeamGoalsContainer" class="goals-scroll-container">
                    <!-- Detailed goals will be rendered here by JS -->
                </div>
            </div>

            <!-- 2-2. íŒ€ì›ë³„ êµìœ¡ ëª©í‘œ ë° ì´ìˆ˜ í˜„í™© (ê¸°ì¡´) - MOVED DOWN -->
            <div>
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">íŒ€ì›ë³„ êµìœ¡ ëª©í‘œ ë° ì´ìˆ˜ í˜„í™© (í’ˆì§ˆê²½ì˜íŒ€)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="p-3 bg-soft-blue rounded-lg border border-blue-200 hover:bg-blue-50 transition cursor-pointer" onclick="openMemberDetailModal('20220458')">
                        <div class="flex justify-between items-start">
                            <span class="font-semibold text-blue-600 hover:underline">ë°•ë™í˜ (20220458)</span>
                            <span class="text-sm font-bold text-blue-800">70.0%</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">ì´ ì´ìˆ˜ ì‹œê°„: 14.0 ì‹œê°„ (ëª©í‘œ: 20.0 ì‹œê°„)</p>
                        <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 70.0%"></div>
                        </div>
                    </div>
                    <div class="p-3 bg-soft-blue rounded-lg border border-blue-200 hover:bg-blue-50 transition cursor-pointer" onclick="openMemberDetailModal('201920458')">
                        <div class="flex justify-between items-start">
                            <span class="font-semibold text-blue-600 hover:underline">ê¹€ë™í˜ (201920458)</span>
                            <span class="text-sm font-bold text-blue-800">53.3%</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">ì´ ì´ìˆ˜ ì‹œê°„: 8.0 ì‹œê°„ (ëª©í‘œ: 15.0 ì‹œê°„)</p>
                        <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 53.3%"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 3. ì˜ˆìƒ ì—…ë¬´ ì ìš© ë°œí˜„ ì‹œì  (êµ¬ì„±ì›ë³„) (ê¸°ì¡´) -->
        <!-- MODIFIED: Title Change -->
        <h2 class="text-xl font-bold text-gray-700 mb-6">3. ì˜ˆìƒ ì—…ë¬´ ì ìš© ë°œí˜„ ì‹œì </h2>
        <div class="card bg-white p-6 border border-gray-200">
            <!-- REMOVED: h3 ë¶€ì œëª© ì œê±° -->
            <div id="applicationTimingList" class="grid gap-4 grid-cols-1 mt-0">
                <p class="text-center text-gray-500 p-4">ë°ì´í„° ë¡œë“œ ì¤‘...</p>
            </div>
        </div>

        <!-- 4. ë¯¸ì´ìˆ˜ì (ê¸°ì¡´) -->
        <!-- MODIFIED: Section 4 Title and Structure Change -->
        <h2 class="text-xl font-bold text-gray-700 mb-6">4. ì˜ë¬´êµìœ¡ ë¯¸ì´ìˆ˜ì</h2>
        <div class="card bg-white p-6 border border-gray-200 space-y-4">
            <div class="flex justify-between items-center">
                <!-- MODIFIED: ì œëª©ì— ê´„í˜¸ ì—´ê³  ë¯¸ì´ìˆ˜ì ìˆ˜ í‘œì‹œ -->
                <h3 class="text-lg font-bold text-gray-800">ì˜ë¬´êµìœ¡ ë¯¸ì´ìˆ˜ì (<span id="nonCompletersCount">0</span>ëª…)</h3>
                <button onclick="toggleNonCompletersList()" class="text-sm font-semibold text-red-600 hover:text-red-700 transition duration-150">
                    ìƒì„¸ ëª©ë¡ í¼ì¹˜ê¸°/ìˆ¨ê¸°ê¸°
                </button>
            </div>
            
            <!-- MODIFIED: í¼ì³ì§€ëŠ” ìƒì„¸ ì •ë³´ ì˜ì—­ë§Œ ë‚¨ê¹€ -->
            <div id="expandedNonCompletersList" class="hidden rounded-xl border border-red-200 shadow-inner bg-white">
                <!-- Content injected by renderNonCompleters() -->
            </div>
        </div>


        <!-- 5. êµìœ¡ ì´ìˆ˜ ë‚´ì—­ (ê¸°ì¡´) -->
        <div class="card bg-white p-6 border border-gray-200">
            <h2 class="text-xl font-bold text-gray-700 mb-6">5. êµìœ¡ ì´ìˆ˜ ë‚´ì—­</h2>

            <!-- ê²€ìƒ‰ í•„í„° ì˜ì—­ -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-x-4 gap-y-6 mb-6 border-b pb-6">
                
                <!-- ê³¼ì •ëª… ê²€ìƒ‰ (Input) -->
                <div class="col-span-2 md:col-span-1">
                    <label for="filterCourseName" class="text-xs font-semibold text-gray-500 block mb-1">ê³¼ì •ëª… ê²€ìƒ‰</label>
                    <input type="text" id="filterCourseName" placeholder="êµìœ¡ëª… í‚¤ì›Œë“œ"
                        class="h-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                
                <!-- ì„±ëª… ê²€ìƒ‰ (ì‚¬ë²ˆ) (Select) -->
                <div class="col-span-2 md:col-span-1">
                    <label for="filterEmployeeNameSelect" class="text-xs font-semibold text-gray-500 block mb-1">ì„±ëª… ê²€ìƒ‰ (ì‚¬ë²ˆ)</label>
                    <select id="filterEmployeeNameSelect" class="h-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">ì „ì²´ ì¸ì›</option>
                    </select>
                </div>
                
                <!-- ì§ì±… (Dropdown) -->
                <div class="col-span-2 md:col-span-1">
                    <label for="jobTitle" class="text-xs font-semibold text-gray-500 block mb-1">ì§ì±…</label>
                    <select id="jobTitle" class="h-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">ì „ì²´ ì§ì±…</option>
                        <option value="íŒ€ì¥">íŒ€ì¥</option>
                        <option value="ì‚¬ì›">ì‚¬ì›</option>
                    </select>
                </div>
                
                <!-- êµ¬ë¶„/ìƒíƒœ (Dropdown) -->
                <div class="col-span-2 md:col-span-1">
                    <label for="statusType" class="text-xs font-semibold text-gray-500 block mb-1">êµ¬ë¶„ (ìƒíƒœ)</label>
                    <select id="statusType" class="h-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                        <option value="ì´ìˆ˜ì™„ë£Œ">ì´ìˆ˜ì™„ë£Œ</option>
                    </select>
                </div>

                <!-- ê²€ìƒ‰/ì´ˆê¸°í™” ë²„íŠ¼ ê·¸ë£¹ -->
                <div class="col-span-2 md:col-span-1 flex items-end space-x-3">
                    <button id="searchButton" class="flex-1 px-4 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition shadow-md">ê²€ìƒ‰</button>
                    <button id="clearFiltersButton" class="flex-1 px-4 py-2 bg-gray-400 text-white font-semibold rounded-lg hover:bg-gray-500 transition shadow-md">ì´ˆê¸°í™”</button>
                </div>
            </div>

            <!-- êµìœ¡ ì´ë ¥ ëª©ë¡ ì˜ì—­ -->
            <div id="filteredEducationList" class="space-y-4">
                <!-- í•„í„°ë§ëœ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤. -->
                <p class="text-center text-gray-500 p-4">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        </div>
    </div> 
    
    <!-- íŒ€ì› ìƒì„¸ ì •ë³´ ëª¨ë‹¬ (ê¸°ì¡´) -->
    <div id="memberDetailModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 id="modalMemberName" class="text-2xl font-bold text-gray-800"></h3>
                <button onclick="closeMemberDetailModal()" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700 text-sm" id="modalMemberDetails">
                <!-- Details will be injected here -->
            </div>
            <button onclick="closeMemberDetailModal()" class="mt-6 w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-md">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- êµìœ¡ ì´ë ¥ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ (ê¸°ì¡´) -->
    <div id="educationDetailModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-bold text-gray-800">êµìœ¡ ì´ë ¥ ìƒì„¸</h3>
                <button onclick="closeEducationDetailModal()" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700 text-sm" id="educationDetailBody">
                <!-- Content injected by openEducationDetailModal -->
            </div>
            <button onclick="closeEducationDetailModal()" class="mt-6 w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition shadow-md">í™•ì¸</button>
        </div>
    </div>


    <!-- êµìœ¡ ì§„í–‰ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ (ê¸°ì¡´) -->
    <div id="inProgressTrainingModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 id="inProgressModalTitle" class="text-xl font-bold text-gray-800"></h3>
                <button onclick="closeInProgressTrainingModal()" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700" id="trainingModalReportFields">
                <!-- Report Fields will be injected here -->
            </div>
            <button onclick="closeInProgressTrainingModal()" class="mt-6 w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition shadow-md">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- NEW: ì¼ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addScheduleModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-bold text-gray-800">ìƒˆ êµìœ¡ ì¼ì • ì¶”ê°€</h3>
                <button onclick="closeAddScheduleModal()" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p class="text-sm text-gray-600">ì…ë ¥ëœ ì¼ì •ì€ ëª¨ì˜ ë°ì´í„°ì— ì¶”ê°€ë©ë‹ˆë‹¤. (DB ë¯¸ì—°ê²°)</p>
                <!-- Validation Message Area -->
                <p id="validationMessage" class="text-sm font-semibold text-red-600 hidden bg-red-50 p-2 rounded"></p>
                
                <div class="space-y-3">
                    <label class="block">
                        <span class="text-sm font-semibold text-gray-700">êµìœ¡ ê³¼ì •ëª…</span>
                        <input type="text" id="newScheduleName" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="ì˜ˆ: í’ˆì§ˆ í‘œì¤€ ê°œì • êµìœ¡">
                    </label>
                    <div class="flex space-x-4">
                        <label class="block flex-1">
                            <span class="text-sm font-semibold text-gray-700">ì‹œì‘ì¼</span>
                            <input type="date" id="newScheduleStart" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </label>
                        <label class="block flex-1">
                            <span class="text-sm font-semibold text-gray-700">ì¢…ë£Œì¼</span>
                            <input type="date" id="newScheduleEnd" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </label>
                    </div>
                    <label class="block">
                        <span class="text-sm font-semibold text-gray-700">êµìœ¡ êµ¬ë¶„ (ìƒ‰ìƒ)</span>
                        <select id="newScheduleType" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="ì‚¬ì™¸">ì‚¬ì™¸ êµìœ¡ (íŒŒë€ìƒ‰)</option>
                            <option value="ìƒì‹œ">ìƒì‹œ í•™ìŠµ (ì‚¬ë‚´) (ë…¹ìƒ‰)</option>
                        </select>
                    </label>
                </div>
            </div>
            <button onclick="saveNewSchedule()" class="mt-6 w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-md">ì¼ì • ì¶”ê°€ (Mock)</button>
            <button onclick="closeAddScheduleModal()" class="mt-3 w-full py-3 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition shadow-md">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- NEW: íŒ€ë³„ ìƒì„¸ ëª©í‘œ ëª¨ë‹¬ -->
    <div id="teamGoalsModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <!-- Header -->
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-bold text-gray-800">íŒ€ë³„ ìƒì„¸ êµìœ¡ ëª©í‘œ (2025)</h3>
                <button onclick="closeTeamGoalsModal()" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>
                </button>
            </div>
            <!-- Content -->
            <div id="teamGoalsBody" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                <!-- JS will inject content here -->
            </div>
            <!-- Footer -->
            <button onclick="closeTeamGoalsModal()" class="mt-6 w-full py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition shadow-md">ë‹«ê¸°</button>
        </div>
    </div>
    
    <!-- NEW: ì»¤ìŠ¤í…€ íˆ´íŒ ìš”ì†Œ (í˜ì´ì§€ ë§¨ ì•„ë˜ ì¶”ê°€) -->
    <div id="calendar-tooltip" class="hidden fixed z-[9999] bg-gray-800 bg-opacity-90 text-white p-3 rounded-lg shadow-xl text-left pointer-events-none transition-opacity duration-100 border border-gray-600 backdrop-blur-sm max-w-xs">
    </div>

</div>
</body>
</html>