<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ë‚´ ì •ë³´ ê³µìœ  í—ˆë¸Œ</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content.active { display: block; }
        .tab-content:not(.active) { display: none; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        .db-scroll-area::-webkit-scrollbar { width: 6px; }
        .db-scroll-area::-webkit-scrollbar-thumb { background-color: #a5b4fc; border-radius: 3px; }
        .db-scroll-area::-webkit-scrollbar-track { background-color: #e5e7eb; border-radius: 3px; }
        .db-scroll-area { scrollbar-width: thin; scrollbar-color: #a5b4fc #e5e7eb; }

        /* í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì• ë‹ˆë©”ì´ì…˜ */
        .progress-bar > div { transition: width 0.5s ease-in-out; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        indigo: { '300': '#a5b4fc', '600': '#4f46e5', '700': '#4338ca', '500': '#6366f1' },
                        teal: { '500': '#14b8a6', '600': '#0d9488', '700': '#0f766e' },
                        amber: { '500': '#f59e0b', '600': '#d97706', '700': '#b45309' },
                        red: { '500': '#ef4444', '600': '#dc2626', '700': '#b91c1c' },
                        cyan: { '500': '#06b6d4', '600': '#0891b2' },
                        lime: { '500': '#84cc16', '600': '#65a30d' },
                        orange: { '500': '#f97316', '600': '#ea580c', '700': '#c2410c' }
                    }
                }
            }
        }

        // --- ì•„ì´ì½˜ SVG ìƒì„± í•¨ìˆ˜ (ì „ì—­) ---
        function getIconSVG(name, classes) {
            const icons = {
                'Bell': '<path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 01-3.46 0"></path>',
                'BookOpen': '<path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"></path><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"></path>',
                'Users': '<path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"></path>',
                'User': '<path d="M19 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>',
                'Link': '<path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07L13 10l-2 3M7 7l-3 3a5 5 0 007.07 7.07l3-3l-2-3M19 19L5 5"></path>',
                'ClipboardList': '<rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path d="M8 11h.01"></path><path d="M8 16h.01"></path>',
                'Globe': '<circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>',
                'Calendar': '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>',
                'Target': '<circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle>',
                'ListChecks': '<path d="M8 6h11"></path><path d="M8 12h11"></path><path d="M8 18h11"></path><path d="M4 6.5l-1.5 1.5l-2.5 -3"></path><path d="M4 12.5l-1.5 1.5l-2.5 -3"></path><path d="M4 18.5l-1.5 1.5l-2.5 -3"></path>',
                'ShoppingBag': '<path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path>',
                'Plus': '<path d="M12 5v14"></path><path d="M5 12h14"></path>',
                'X': '<path d="M18 6L6 18"></path><path d="M6 6l12 12"></path>',
                'Eye': '<path d="M2 12s4-8 10-8 10 8 10 8-4 8-10 8-10-8-10-8z"></path><circle cx="12" cy="12" r="3"></circle>',
                'TrendingUp': '<polyline points="18 13 22 17 19 19 16 16 11 21"></polyline><path d="M12 11V5a1 1 0 00-1-1H5"></path>',
                'MessageSquare': '<path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"></path>',
                'Check': '<polyline points="20 6 9 17 4 12"></polyline>',
                'LogOut': '<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line>',
                'Clipboard': '<path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>'
            };
            const svgContent = icons[name] || '';
            return `<svg xmlns="http://www.w3.org/2000/svg" class="${classes}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${svgContent}</svg>`;
        }

        // --- ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ (ì „ì—­) ---
        window.displayMessage = function(message, type = 'error') {
            const container = document.getElementById('message-container');
            if (!container) { console.error("Message container not found."); return; }
            const iconName = type === 'error' ? 'X' : 'Check';
            const iconSvg = getIconSVG(iconName, 'w-5 h-5');
            const color = type === 'error' ? 'bg-red-600' : 'bg-green-600';
            const messageElement = document.createElement('div');
            messageElement.className = `p-4 rounded-lg shadow-xl text-white font-semibold flex items-center space-x-3 ${color} mb-2 opacity-0 transition-opacity duration-300 transform translate-y-2 pointer-events-auto`;
            messageElement.innerHTML = `${iconSvg} <span>${message}</span>`;
            container.appendChild(messageElement);
            setTimeout(() => {
                messageElement.classList.remove('opacity-0', 'translate-y-2');
                messageElement.classList.add('opacity-100', 'translate-y-0');
            }, 10);
            setTimeout(() => {
                messageElement.classList.remove('opacity-100', 'translate-y-0');
                messageElement.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => messageElement.remove(), 300);
            }, 5000);
        };

        // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° í•¨ìˆ˜ (ì „ì—­)
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            // í•­ìƒ ì—´ ìˆ˜ ìˆëŠ” ëª¨ë‹¬ë“¤
            const isAlwaysOpenModal = modalId === 'danggn-post-modal' || modalId === 'notice-detail-modal' || modalId === 'full-history-modal' || modalId === 'annual-plan-modal' || modalId === 'training-report-modal';
            
            // ë¡œê·¸ì¸ ì²´í¬ (ì—¬ê¸°ì„œëŠ” URL íŒŒë¼ë¯¸í„° ì²´í¬ë¡œ ëŒ€ì²´)
            // Firebaseê°€ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ window.isLoggedIn ëŒ€ì‹  ë‹¤ë¥¸ ë°©ì‹ì„ ì‚¬ìš©í•˜ê±°ë‚˜
            // í˜„ì¬ëŠ” ê°„ë‹¨íˆ í†µê³¼ì‹œí‚µë‹ˆë‹¤. (í•„ìš” ì‹œ URL íŒŒë¼ë¯¸í„° ì²´í¬ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥)
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                modal.querySelector('.bg-white').classList.add('scale-100');
                modal.querySelector('.bg-white').classList.remove('scale-95');

                if (modalId === 'full-history-modal' && typeof window.renderFullTrainingHistory === 'function') {
                    window.renderFullTrainingHistory();
                }
                
                if (modalId === 'annual-plan-modal' && typeof window.renderAnnualPlan === 'function') {
                    window.renderAnnualPlan();
                }
            }, 10);
        }

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('opacity-100');
            modal.querySelector('.bg-white').classList.remove('scale-100');
            modal.querySelector('.bg-white').classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }
    </script>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
    <div id="message-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[100] w-full max-w-md px-4 pointer-events-none"></div>

    <!-- ì „ì²´ ë ˆì´ì•„ì›ƒ ê·¸ë¦¬ë“œ: 4ì—´ êµ¬ì¡° -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 max-w-7xl mx-auto">

        <!-- Column 1 (lg:col-span-1): ì‚¬ì´ë“œë°” -->
        <aside class="lg:col-span-1 space-y-6" id="sidebar-content">
            <!-- ì‚¬ì´ë“œë°” ë‚´ìš©ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„± -->
        </aside>

        <!-- Column 2 (lg:col-span-3): ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
        <div class="lg:col-span-3">
            <!-- í—¤ë” ë° íƒ€ì´í‹€ -->
            <header class="mb-8 bg-white p-6 rounded-xl shadow-lg">
                <h1 class="text-3xl font-extrabold text-indigo-700 tracking-tight flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    ì‚¬ë‚´ ì •ë³´ ê³µìœ  í—ˆë¸Œ
                </h1>
                <p class="text-gray-500 mt-1">ìš°ë¦¬ íšŒì‚¬ì˜ ê³µì§€, í•™ìŠµ ìë£Œ, ì†Œí†µ ê³µê°„ì„ í•œ ê³³ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>
            </header>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
            <nav class="flex space-x-4 mb-8 p-1 bg-white rounded-xl shadow-md" id="tab-nav">
                <!-- ë²„íŠ¼ë“¤ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
            </nav>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <main class="min-h-[600px]" id="tab-content-container">
                <!-- ê° íƒ­ì˜ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
            </main>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
        &copy; <span id="current-year"></span> ë‚´ë¶€ ì»¤ë®¤ë‹ˆí‹°. All rights reserved.
    </footer>

    <!-- ê³µí†µ ëª¨ë‹¬ êµ¬ì¡°ëŠ” ìœ ì§€í•˜ë˜ ë°ì´í„°ëŠ” ë¹„ì›ë‹ˆë‹¤ -->

    <!-- ìƒˆ ìë£Œ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="training-post-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-95" onclick="event.stopPropagation()">
            <form id="training-post-form" class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-teal-700">ìƒˆ êµìœ¡ ìë£Œ ë“±ë¡</h3>
                    <button type="button" onclick="closeModal('training-post-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100 transition duration-150" aria-label="ë‹«ê¸°">${getIconSVG('X', 'w-6 h-6')}</button>
                </div>
                <!-- ì…ë ¥ í•„ë“œëŠ” ìœ ì§€ -->
                <div><label class="block text-sm font-medium text-gray-700 mb-1">ì œëª©</label><input type="text" name="title" class="w-full p-3 border border-gray-300 rounded-lg" required></div>
                <div><label class="block text-sm font-medium text-gray-700 mb-1">ë‚´ìš©</label><textarea name="summary" class="w-full p-3 border border-gray-300 rounded-lg" required></textarea></div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('training-post-modal')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">ì·¨ì†Œ</button>
                    <button type="submit" class="px-6 py-2 bg-teal-600 text-white rounded-lg font-bold hover:bg-teal-700">ë“±ë¡</button>
                </div>
            </form>
            <script>document.getElementById('training-post-modal').addEventListener('click', (e) => { if(e.target.id === 'training-post-modal') closeModal('training-post-modal'); });</script>
        </div>
    </div>

    <!-- ì»¤ë®¤ë‹ˆí‹° ë“±ë¡ ëª¨ë‹¬ -->
    <div id="community-post-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-95" onclick="event.stopPropagation()">
            <form id="community-post-form" class="p-6 bg-white rounded-xl space-y-4">
                 <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-amber-700">ì‹ ì²­ì„œ ì‘ì„±</h3>
                    <button type="button" onclick="closeModal('community-post-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100" aria-label="ë‹«ê¸°">${getIconSVG('X', 'w-6 h-6')}</button>
                </div>
                <div><label class="block text-sm font-medium text-gray-700 mb-1">ì¡°ì§ëª…</label><input type="text" name="title" class="w-full p-3 border border-gray-300 rounded-lg" required></div>
                <div><label class="block text-sm font-medium text-gray-700 mb-1">ë‚´ìš©</label><textarea name="content" class="w-full p-3 border border-gray-300 rounded-lg" required></textarea></div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('community-post-modal')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">ì·¨ì†Œ</button>
                    <button type="submit" class="px-6 py-2 bg-amber-600 text-white rounded-lg font-bold hover:bg-amber-700">ì œì¶œ</button>
                </div>
            </form>
             <script>document.getElementById('community-post-modal').addEventListener('click', (e) => { if(e.target.id === 'community-post-modal') closeModal('community-post-modal'); });</script>
        </div>
    </div>
    
     <!-- ë‹¹ê·¼ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="danggn-post-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
         <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-95" onclick="event.stopPropagation()">
            <div class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-orange-700">ìƒˆ ê¸€ ì‘ì„±</h3>
                     <button type="button" onclick="closeModal('danggn-post-modal')" class="p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100" aria-label="ë‹«ê¸°">${getIconSVG('X', 'w-6 h-6')}</button>
                </div>
                 <div class="bg-orange-50 border-l-4 border-orange-500 text-orange-700 p-4"><p>í˜„ì¬ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p></div>
            </div>
             <script>document.getElementById('danggn-post-modal').addEventListener('click', (e) => { if(e.target.id === 'danggn-post-modal') closeModal('danggn-post-modal'); });</script>
         </div>
    </div>

    <!-- ê¸°íƒ€ ëª¨ë‹¬ë“¤ (ë‚´ìš© ë¹„ì›€) -->
    <div id="full-history-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-95" onclick="event.stopPropagation()">
            <div class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-amber-700">ì „ì²´ ì´ë ¥</h3>
                    <button type="button" onclick="closeModal('full-history-modal')" class="p-2 text-gray-500">${getIconSVG('X', 'w-6 h-6')}</button>
                </div>
                <ul id="full-history-list" class="space-y-2"><li class="text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li></ul>
            </div>
             <script>document.getElementById('full-history-modal').addEventListener('click', (e) => { if(e.target.id === 'full-history-modal') closeModal('full-history-modal'); });</script>
        </div>
    </div>
    
    <div id="annual-plan-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-transform duration-300 scale-95" onclick="event.stopPropagation()">
             <div class="p-6 bg-white rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-lime-700">êµìœ¡ ê³„íš</h3>
                    <button type="button" onclick="closeModal('annual-plan-modal')" class="p-2 text-gray-500">${getIconSVG('X', 'w-6 h-6')}</button>
                </div>
                <ul id="annual-plan-list" class="space-y-2"><li class="text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li></ul>
            </div>
            <script>document.getElementById('annual-plan-modal').addEventListener('click', (e) => { if(e.target.id === 'annual-plan-modal') closeModal('annual-plan-modal'); });</script>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        // --- Google Apps Script URL (Sheet Connection) ---
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzSzCH66xjcAePJVBRCJogEHVw0GUp4nrbYCCdheL0YSUGdAc2nmFIa4iX-Xrh1-P_r/exec";

        // --- Mock Data Removed (Initialized as empty arrays) ---
        const mockNotices = [];
        const fullTrainingHistory = [];
        const annualTrainingPlan = [];
        const trainingProposals = [];

        // --- Google Apps Scriptì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ---
        async function fetchUserInfoFromSheet(uid) {
            if (!uid) return;
            const nameEl = document.getElementById('info-name');
            const idEl = document.getElementById('info-employeeId');
            
            const elEmail = document.getElementById('info-email');
            const elDept = document.getElementById('info-department');
            const elPos = document.getElementById('info-position');
            
            if(elEmail) elEmail.textContent = '...';
            if(elDept) elDept.textContent = '...';
            if(elPos) elPos.textContent = '...';

            try {
                // ìˆ˜ì •: íŒŒë¼ë¯¸í„°ë¥¼ ì œê±°í•˜ê³  ì „ì²´ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë„ë¡ ë³€ê²½ (ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ ì‚¬ìš©)
                // ì´ìœ : GAS ì›¹ì•±ì´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•˜ì§€ ì•Šê±°ë‚˜ CORS ë¬¸ì œë¡œ ì¸í•´ íŠ¹ì • íŒŒë¼ë¯¸í„° ìš”ì²­ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
                const url = APPS_SCRIPT_URL; 
                
                // Fetch ì˜µì…˜ì— no-corsë‚˜ ë‹¤ë¥¸ ì„¤ì •ì„ ë„£ìœ¼ë©´ opaque responseê°€ ë˜ì–´ ë°ì´í„°ë¥¼ ëª» ì½ì„ ìˆ˜ ìˆìŒ.
                const response = await fetch(url, { redirect: 'follow' }); // redirect ì˜µì…˜ ì¶”ê°€
                
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                
                const jsonResponse = await response.json();
                
                let users = [];
                if (Array.isArray(jsonResponse)) {
                    users = jsonResponse;
                } else if (jsonResponse.data && Array.isArray(jsonResponse.data)) {
                    users = jsonResponse.data;
                }

                // 4. ì‚¬ìš©ì ì°¾ê¸°
                let matchedUser = null;
                if (users.length > 0) {
                    const firstItem = users[0];
                    if (Array.isArray(firstItem)) {
                        // 2ì°¨ì› ë°°ì—´ì¸ ê²½ìš° (í–‰ ë°ì´í„°)
                        // A:0(Name), B:1(UID), C:2(Grade), D:3(Dept), E:4(Email)
                        const foundRow = users.find(row => String(row[1]) === String(uid));
                        if (foundRow) {
                            matchedUser = {
                                userName: foundRow[0],
                                userUid: foundRow[1],
                                gradeName: foundRow[2],
                                deptName: foundRow[3],
                                sysmail: foundRow[4]
                            };
                        }
                    } else {
                        // ê°ì²´ ë°°ì—´ì¸ ê²½ìš° (í‚¤ê°’ ë§¤ì¹­)
                        matchedUser = users.find(u => String(u.userUid) === String(uid));
                    }
                }
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸ (ì´ë¦„/ì‚¬ë²ˆ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ í•„ë“œë§Œ)
                if (matchedUser) {
                    if(elEmail) elEmail.textContent = matchedUser.sysmail || '-'; 
                    if(elDept) elDept.textContent = matchedUser.deptName || '-'; 
                    if(elPos) elPos.textContent = matchedUser.gradeName || '-'; 
                } else {
                    if(elEmail) elEmail.textContent = '-';
                    if(elDept) elDept.textContent = '-';
                    if(elPos) elPos.textContent = '-';
                }
            } catch (error) {
                console.error("Sheet Fetch Error:", error); 
                if(elEmail) elEmail.textContent = '-';
                if(elDept) elDept.textContent = '-';
                if(elPos) elPos.textContent = '-';
            }
        }
        
        // --- ê¸°ëŠ¥ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜ (ë‹¨ìˆœí™”) ---
        function enableFeatures(isLoggedIn) {
            const buttons = document.querySelectorAll('button[onclick^="openModal"], button[type="submit"], #logout-button');
            buttons.forEach(button => {
                // ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ì¼ë‹¨ í™œì„±í™”í•˜ê±°ë‚˜, í•„ìš”ì‹œ ë¡œì§ ì¶”ê°€
                // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•˜ê²Œ ëª¨ë‘ í™œì„±í™” (ë°ì´í„°ê°€ ì—†ì–´ì„œ ë™ì‘ì€ ì œí•œì )
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
            });
        }

        // --- ì‚¬ì´ë“œë°” ì‚¬ìš©ì ID ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        const userInfoFields = ['employeeId', 'name', 'email', 'department', 'position'];
        
        function updateSidebarUserId(urlName, urlUid) {
            const displayName = urlName || 'ê²ŒìŠ¤íŠ¸';
            const displayUid = urlUid || '-';

            const userInfo = {
                employeeId: displayUid, 
                name: displayName, 
                email: '...', 
                department: '...', 
                position: '...'
            };

            userInfoFields.forEach(key => {
                const el = document.getElementById(`info-${key}`);
                if (el) el.textContent = userInfo[key] || 'N/A';
            });

            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì´ˆê¸°í™” (ë°ì´í„° ì—†ìŒ)
            updateProgressBars({ goal: 0, actual: 0, mandatoryExternal: 0 });
        }

        // --- í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateProgressBars(data) {
            const goalTime = data.goal || 0;
            const actualTime = data.actual || 0;
            const mandatoryExternalTime = data.mandatoryExternal || 0;
            const mandatoryGoal = 12;

            const goalPercent = goalTime > 0 ? (actualTime / goalTime) * 100 : 0;
            const mandatoryPercent = (mandatoryExternalTime / mandatoryGoal) * 100;

            const goalBarFill = document.getElementById('progress-goal-fill');
            const goalBarText = document.getElementById('progress-goal-text');
            const mandatoryBarFill = document.getElementById('progress-mandatory-fill');
            const mandatoryBarText = document.getElementById('progress-mandatory-text');

            if (goalBarFill) goalBarFill.style.width = `${Math.min(goalPercent, 100)}%`;
            if (goalBarText) goalBarText.textContent = `${actualTime}h / ${goalTime}h (${goalPercent.toFixed(0)}%)`;
            if (mandatoryBarFill) mandatoryBarFill.style.width = `${Math.min(mandatoryPercent, 100)}%`;
            if (mandatoryBarText) mandatoryBarText.textContent = `${mandatoryExternalTime}h / ${mandatoryGoal}h (${mandatoryPercent.toFixed(0)}%)`;
        }

        // --- ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ---
        window.logout = async () => {
             window.displayMessage("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
             try {
                 const LOGIN_PAGE_PATH = 'index.html';
                 window.location.href = LOGIN_PAGE_PATH;
             } catch(e) {
                 window.displayMessage("í˜ì´ì§€ ì´ë™ ì‹¤íŒ¨.", 'error');
             }
        };

        // --- ëª¨ì˜ ë°ì´í„° ë Œë”ë§ (ë¹„ì–´ ìˆìŒ) ---
        function renderMockTrainingSummary() {
             const listContainer = document.getElementById('training-list-container');
             const top3Container = document.getElementById('top3-cards-container');
             const noDataMessage = document.getElementById('no-data-message-training');
             const dbSection = document.getElementById('db-section');

             if(top3Container) top3Container.innerHTML = '<p class="text-gray-500 col-span-3 text-center py-4">ë“±ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
             if(listContainer) listContainer.innerHTML = '';
             if(dbSection) dbSection.classList.add('hidden');
             if(noDataMessage) noDataMessage.classList.remove('hidden');
        }

        // --- ì „ì²´ êµìœ¡ ì´ë ¥ ëª¨ë‹¬ ë Œë”ë§ í•¨ìˆ˜ ---
        window.renderFullTrainingHistory = function() {
            const listContainer = document.getElementById('full-history-list');
            if (!listContainer) return;
            listContainer.innerHTML = '<li class="text-center py-10 text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
        }
        
        // --- ì—°ê°„ êµìœ¡ ê³„íš ëª¨ë‹¬ ë Œë”ë§ í•¨ìˆ˜ ---
        window.renderAnnualPlan = function() {
            const listContainer = document.getElementById('annual-plan-list');
            if (!listContainer) return;
            listContainer.innerHTML = '<li class="text-center py-10 text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
        }

        // --- ê°€ì§œ ì €ì¥ í•¨ìˆ˜ (UI ë°˜ì‘ë§Œ í•¨) ---
        window.saveTrainingPost = (e) => {
            e.preventDefault();
            window.displayMessage("ì €ì¥ ê¸°ëŠ¥ì€ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ì„œë²„ ë¯¸ì—°ë™)", 'error');
            closeModal('training-post-modal');
        };
        window.saveCommunityPost = (e) => {
            e.preventDefault();
            window.displayMessage("ì €ì¥ ê¸°ëŠ¥ì€ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ì„œë²„ ë¯¸ì—°ë™)", 'error');
            closeModal('community-post-modal');
        };
        window.saveAnnualPlan = (e) => {
            e.preventDefault();
            window.displayMessage("ì €ì¥ ê¸°ëŠ¥ì€ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ì„œë²„ ë¯¸ì—°ë™)", 'error');
            closeModal('annual-plan-create-modal');
        };

        // --- UI ë° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        function setActiveTab(tabName) {
            document.querySelectorAll('#tab-nav button').forEach(btn => {
                const isActive = btn.dataset.tab === tabName;
                btn.classList.toggle('bg-indigo-600', isActive && tabName === 'ê³µì§€ì‚¬í•­');
                btn.classList.toggle('bg-teal-600', isActive && tabName === 'êµìœ¡ìë£Œ ê³µìœ ');
                btn.classList.toggle('bg-amber-600', isActive && tabName === 'ë™ì•„ë¦¬/í•™ìŠµì¡°ì§ ì‹ ì²­');
                btn.classList.toggle('bg-orange-600', isActive && tabName === 'ë‹¹ê·¼');
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('shadow-lg', isActive);
                btn.classList.toggle('text-gray-600', !isActive);
                btn.classList.toggle('hover:bg-gray-50', !isActive);
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabName.replace(/\s|\//g, '-').toLowerCase());
            });

            if (tabName === 'êµìœ¡ìë£Œ ê³µìœ ') {
                renderMockTrainingSummary();
            }
        }
        window.setActiveTab = setActiveTab;

        // --- ì‚¬ì´ë“œë°” ë° ì´ë™ëœ ì¹´ë“œ ìƒì„± í•¨ìˆ˜ ---
        function createSidebarAndMovedCards() {
            const sidebarContainer = document.getElementById('sidebar-content');
            
            // ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
            const historyItems = '<li class="text-center text-gray-400 py-2">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</li>';

            if (sidebarContainer) {
                sidebarContainer.innerHTML = `
                    <!-- 1. ê´€ë ¨ ì‚¬ì´íŠ¸ ì¹´ë“œ -->
                    <div class="bg-white p-5 rounded-xl shadow-lg border-t-4 border-cyan-500" id="related-sites-card">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">${getIconSVG('Globe', 'w-5 h-5 mr-2 text-cyan-600')} ê´€ë ¨ ì‚¬ì´íŠ¸</h3>
                        <ul class="space-y-3">
                            <li><a href="https://www.hunet.co.kr/" target="_blank" rel="noopener noreferrer" class="text-cyan-600 hover:text-cyan-700 text-sm font-medium flex items-center transition duration-150"><span class="w-2 h-2 rounded-full bg-cyan-400 mr-2 flex-shrink-0"></span> íœ´ë„· (ê¸°ì—… êµìœ¡)</a></li>
                            <li><a href="https://synopex.step.or.kr/main.do" target="_blank" rel="noopener noreferrer" class="text-cyan-600 hover:text-cyan-700 text-sm font-medium flex items-center transition duration-150"><span class="w-2 h-2 rounded-full bg-cyan-400 mr-2 flex-shrink-0"></span> ìŠ¤íƒ­ (STEP)</a></li>
                        </ul>
                    </div>

                    <!-- 2. ê°œì¸ì •ë³´ ì¹´ë“œ -->
                    <div class="bg-white p-5 rounded-xl shadow-lg border-t-4 border-indigo-500 min-h-[350px]" id="user-profile-card">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center space-x-2">
                                <h3 class="text-xl font-bold text-gray-800">ê°œì¸ì •ë³´</h3>
                                <a href="#" onclick="alert('ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤')" 
                                   class="px-3 py-1 text-xs font-semibold rounded-full bg-indigo-500 text-white hover:bg-indigo-600 shadow-md transition duration-200" 
                                   title="ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™"
                                >ë§ˆì´í˜ì´ì§€</a>
                            </div>
                            <button id="logout-button" onclick="logout()" class="p-1.5 text-red-500 hover:text-red-700 hover:bg-red-100 rounded-md transition duration-150" title="ë¡œê·¸ì•„ì›ƒ">
                                ${getIconSVG('LogOut', 'w-5 h-5')}
                            </button>
                        </div>
                        <div class="space-y-4">
                            <!-- ê°œì¸ ì •ë³´ í•­ëª© -->
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                                <div class="col-span-1"><label class="block text-xs font-medium text-gray-500">ì‚¬ë²ˆ</label><p id="info-employeeId" class="text-sm text-gray-900 font-semibold truncate">-</p></div>
                                <div class="col-span-1"><label class="block text-xs font-medium text-gray-500">ì´ë¦„</label><p id="info-name" class="text-sm text-gray-900 font-semibold truncate">-</p></div>
                                <div class="col-span-2"><label class="block text-xs font-medium text-gray-500">ì´ë©”ì¼</label><p id="info-email" class="text-sm text-gray-900 font-semibold truncate">-</p></div>
                                <div class="col-span-1"><label class="block text-xs font-medium text-gray-500">ë¶€ì„œëª…</label><p id="info-department" class="text-sm text-gray-900 font-semibold truncate">-</p></div>
                                <div class="col-span-1"><label class="block text-xs font-medium text-gray-500">ì§ì±…</label><p id="info-position" class="text-sm text-gray-900 font-semibold truncate">-</p></div>
                            </div>
                            <!-- ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ ì¼ì • -->
                            <div class="border-t pt-4 mt-4">
                                <h4 class="text-sm font-semibold text-gray-700 mb-2 flex items-center">${getIconSVG('Calendar', 'w-4 h-4 mr-1 text-indigo-500')} ë‹¤ê°€ì˜¤ëŠ” êµìœ¡ ì¼ì •</h4>
                                <ul class="space-y-1 text-xs text-gray-600">
                                     <li class="text-center text-gray-400 py-1">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                            <!-- êµìœ¡ ëª©í‘œ ë‹¬ì„± í˜„í™© -->
                            <div class="border-t pt-4 mt-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-sm font-semibold text-gray-700 flex items-center">${getIconSVG('Target', 'w-4 h-4 mr-1 text-lime-600')} êµìœ¡ ëª©í‘œ ë‹¬ì„± í˜„í™©</h4>
                                    <button onclick="openModal('annual-plan-modal')" class="text-xs font-medium text-lime-600 hover:text-lime-700 transition duration-150 px-2 py-1 rounded-md bg-lime-50 hover:bg-lime-100" title="ê¸ˆë…„ë„ êµìœ¡ ê³„íšì„ í™•ì¸í•©ë‹ˆë‹¤.">ê¸ˆë…„ë„ ê³„íš ì¡°íšŒ &rarr;</button>
                                </div>
                                <div class="space-y-3">
                                    <!-- ì „ì²´ ëª©í‘œ ë‹¬ì„±ë¥  -->
                                    <div>
                                        <div class="flex justify-between text-xs font-medium text-gray-600 mb-1">
                                            <span>ì „ì²´ ëª©í‘œ ë‹¬ì„±ë¥ </span>
                                            <span id="progress-goal-text">0h / 0h (0%)</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 progress-bar overflow-hidden">
                                            <div id="progress-goal-fill" class="bg-indigo-500 h-2 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <!-- ì˜ë¬´ (ì‚¬ì™¸) êµìœ¡ ë‹¬ì„±ë¥  -->
                                    <div>
                                        <div class="flex justify-between text-xs font-medium text-gray-600 mb-1">
                                            <span>ì˜ë¬´ (ì‚¬ì™¸) êµìœ¡</span>
                                            <span id="progress-mandatory-text">0h / 12h (0%)</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 progress-bar overflow-hidden">
                                            <div id="progress-mandatory-fill" class="bg-lime-500 h-2 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. íŒ€ êµìœ¡ í˜„í™© ì¹´ë“œ -->
                    <div class="bg-white p-5 rounded-xl shadow-lg border-t-4 border-teal-500" id="training-links-card">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">${getIconSVG('Link', 'w-5 h-5 mr-2 text-teal-600')} íŒ€ êµìœ¡ í˜„í™©</h3>
                        <div class="max-h-[150px] overflow-y-auto db-scroll-area pr-2">
                             <ul class="space-y-3"><li class="text-center text-gray-400 py-2">í˜„í™© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li></ul>
                        </div>
                    </div>

                    <!-- 4. ê°œì¸ êµìœ¡ ì´ë ¥ ì¹´ë“œ -->
                    <div class="bg-white p-5 rounded-xl shadow-lg border-t-4 border-amber-500" id="personal-training-history-card">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">${getIconSVG('ListChecks', 'w-5 h-5 mr-2 text-amber-600')} ê°œì¸ êµìœ¡ ì´ë ¥</h3>
                        <div class="max-h-[150px] overflow-y-auto db-scroll-area pr-2">
                            <ul class="space-y-2 text-sm text-gray-600">
                                ${historyItems}
                                <li><a href="#" onclick="event.preventDefault(); openModal('full-history-modal')" class="text-amber-600 hover:text-amber-700 text-xs font-medium mt-2 inline-block">ì „ì²´ ì´ë ¥ ë³´ê¸° &rarr;</a></li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }


        // --- ì´ˆê¸°í™” ë¡œì§ ---
        window.onload = async () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // 1. URL íŒŒë¼ë¯¸í„°ì—ì„œ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸ (Github Pagesìš©)
            const params = new URLSearchParams(window.location.search);
            const nameFromUrl = params.get('userName') || params.get('name'); // name fallback ì¶”ê°€
            const uidFromUrl = params.get('userUid') || params.get('uid') || params.get('password'); // uid fallback ì¶”ê°€

            // 2. ì‚¬ì´ë“œë°” ë‚´ìš© ìƒì„±
            createSidebarAndMovedCards();

            if (nameFromUrl) {
                updateSidebarUserId(nameFromUrl, uidFromUrl);
            }

            // --- ì¶”ê°€ëœ ë¶€ë¶„: êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë°ì´í„° ì—°ë™ ---
            // URLì— uidê°€ ìˆìœ¼ë©´ GAS WebAppì„ í†µí•´ ìƒì„¸ ì •ë³´ í˜¸ì¶œ
            if (uidFromUrl) {
                fetchUserInfoFromSheet(uidFromUrl);
            }

            // 4. íƒ­ ë° ì»¨í…ì¸  ì˜ì—­ ìƒì„±
            const tabs = [
                { name: 'ê³µì§€ì‚¬í•­', icon: 'Bell', color: 'indigo' },
                { name: 'êµìœ¡ìë£Œ ê³µìœ ', icon: 'BookOpen', color: 'teal' },
                { name: 'ë™ì•„ë¦¬/í•™ìŠµì¡°ì§ ì‹ ì²­', icon: 'Users', color: 'amber' },
                { name: 'ë‹¹ê·¼', icon: 'ShoppingBag', color: 'orange' },
            ];
            const nav = document.getElementById('tab-nav');
            const contentContainer = document.getElementById('tab-content-container');

            if (!nav || !contentContainer) return;
            nav.innerHTML = ''; contentContainer.innerHTML = '';

            tabs.forEach(tab => {
                const tabNameId = tab.name.replace(/\s|\//g, '-').toLowerCase();

                // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
                const btn = document.createElement('button');
                btn.className = 'flex-1 flex items-center justify-center py-3 px-2 rounded-lg text-sm md:text-base font-semibold transition-all duration-300 ease-in-out text-gray-600 hover:bg-gray-50';
                btn.dataset.tab = tab.name;
                btn.innerHTML = `${getIconSVG(tab.icon, 'w-5 h-5 mr-2')} ${tab.name}`;
                btn.onclick = () => setActiveTab(tab.name);
                nav.appendChild(btn);

                // ì»¨í…ì¸  ì˜ì—­ (HTML êµ¬ì¡°)
                const div = document.createElement('div');
                div.id = tabNameId;
                div.className = 'tab-content p-6 bg-white rounded-xl shadow-lg h-full overflow-y-auto';

                let contentHTML = '';
                if (tab.name === 'ê³µì§€ì‚¬í•­') {
                    // ê³µì§€ì‚¬í•­ ë°ì´í„° ì—†ìŒ ì²˜ë¦¬
                    contentHTML = `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            ${getIconSVG('Bell', 'w-6 h-6 mr-2 text-red-500')} ê³µì§€ì‚¬í•­
                        </h2>
                        <div class="space-y-4">
                            <p class="text-center text-gray-500 py-10 border border-dashed rounded-lg">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>`;
                } else if (tab.name === 'êµìœ¡ìë£Œ ê³µìœ ') {
                    contentHTML = `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                            ${getIconSVG('BookOpen', 'w-6 h-6 mr-2 text-teal-500')} êµìœ¡ ì§€ì› ë° ìë£Œ ê³µìœ 
                        </h2>

                        <!-- Section 1: êµìœ¡ í’ˆì˜ì„œ (Training Proposal/Approval) -->
                        <div class="mb-10 p-6 border border-teal-300 rounded-xl bg-teal-50">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-teal-700 flex items-center">
                                    ${getIconSVG('Clipboard', 'w-5 h-5 mr-2 text-teal-500')} ì™„ë£Œëœ êµìœ¡ ë³´ê³ ì„œ (í´ë¦­ ì‹œ ìƒì„¸ ì¡°íšŒ)
                                </h3>
                            </div>
                            <ul class="space-y-1 text-sm text-gray-700" id="proposal-report-list">
                                <li class="text-gray-500 p-2 text-center">ì™„ë£Œëœ êµìœ¡ ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</li>
                            </ul>
                        </div>

                        <!-- Section 2: êµìœ¡ìë£Œ ê³µìœ  (Material Sharing) -->
                        <div class="mt-10">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center justify-between">
                                <span class="flex items-center">${getIconSVG('BookOpen', 'w-5 h-5 mr-2 text-teal-500')} êµìœ¡ìë£Œ ê³µìœ </span>
                                <!-- ìë£Œ ë“±ë¡ ë²„íŠ¼ -->
                                <button onclick="openModal('training-post-modal')" class="px-4 py-2 text-sm font-semibold rounded-full bg-teal-500 text-white hover:bg-teal-600 shadow-md transition duration-200 flex items-center">${getIconSVG('Plus', 'w-4 h-4 mr-1')} ìë£Œ ë“±ë¡</button>
                            </h3>
                            
                            <!-- Top 3 ë‚´ìš© -->
                            <div class="mb-10">
                                <h4 class="text-lg font-bold text-gray-700 mb-4 flex items-center">${getIconSVG('TrendingUp', 'w-5 h-5 mr-2 text-red-500')} ì¡°íšŒìˆ˜ Top 3</h4>
                                <div id="top3-cards-container" class="grid grid-cols-1 md:grid-cols-3 gap-6"><p class="text-gray-500 col-span-3 text-center">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>
                            </div>
                            
                            <!-- ìë£Œ DB ë‚´ìš© -->
                            <div id="db-section" class="mt-8 hidden">
                                <h4 class="text-lg font-bold text-gray-700 mb-4 flex items-center">${getIconSVG('BookOpen', 'w-5 h-5 mr-2 text-teal-500')} ìë£Œ DB (ìµœì‹ ìˆœ)</h4>
                                <div class="border border-gray-200 rounded-xl shadow-sm overflow-y-auto max-h-[400px] db-scroll-area"><div id="training-list-container" class="space-y-0"></div></div>
                            </div>
                            <p id="no-data-message-training" class="hidden text-center py-10 text-gray-500 border border-dashed rounded-lg">ë“±ë¡ëœ êµìœ¡ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                } else if (tab.name === 'ë™ì•„ë¦¬/í•™ìŠµì¡°ì§ ì‹ ì²­') {
                    contentHTML = `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center justify-between">
                            <span class="flex items-center">${getIconSVG('Users', 'w-6 h-6 mr-2 text-amber-500')} ë™ì•„ë¦¬/í•™ìŠµì¡°ì§ ì‹ ì²­</span>
                            <button onclick="openModal('community-post-modal')" class="px-4 py-2 text-sm font-semibold rounded-full bg-amber-500 text-white hover:bg-amber-600 shadow-md transition duration-200 flex items-center">${getIconSVG('Plus', 'w-4 h-4 mr-1')} ì‹ ì²­ì„œ ì‘ì„±</button>
                        </h2>

                        <!-- Section 1: ì‹ ì²­ ë° ìŠ¹ì¸ í˜„í™© -->
                        <div class="mb-10 p-6 border border-amber-300 rounded-xl bg-amber-50">
                            <h3 class="text-xl font-bold text-amber-700 mb-4 flex items-center">${getIconSVG('ClipboardList', 'w-5 h-5 mr-2 text-amber-500')} ì‹ ì²­ ë° ìŠ¹ì¸ í˜„í™© (ê°œì¸)</h3>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="text-center text-gray-500">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                            </ul>
                            <a href="#" class="mt-3 inline-block text-xs font-medium text-amber-600 hover:text-amber-700">ì „ì²´ ì‹ ì²­ í˜„í™© ë³´ê¸° &rarr;</a>
                        </div>
                        
                        <!-- Section 2: í˜„ì¬ í™œë™ ì¡°ì§ ëª©ë¡ -->
                        <div id="community-list-section" class="mt-10">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">${getIconSVG('Users', 'w-5 h-5 mr-2 text-amber-500')} í˜„ì¬ í™œë™ ì¡°ì§ ëª©ë¡</h3>
                            <div class="border border-gray-200 rounded-xl shadow-sm overflow-y-auto max-h-[400px] db-scroll-area">
                                 <p class="text-center text-gray-500 py-4">ë“±ë¡ëœ ì¡°ì§ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    `;
                } else if (tab.name === 'ë‹¹ê·¼') {
                    contentHTML = `
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center justify-between">
                            <span class="flex items-center">${getIconSVG('ShoppingBag', 'w-6 h-6 mr-2 text-orange-500')} ë‹¹ê·¼</span>
                            <button onclick="openModal('danggn-post-modal')" class="px-4 py-2 text-sm font-semibold rounded-full bg-orange-500 text-white hover:bg-orange-600 shadow-md transition duration-200 flex items-center">${getIconSVG('Plus', 'w-4 h-4 mr-1')} ìƒˆ ê¸€ ì‘ì„±</button>
                        </h2>
                        <p class="text-gray-600">ì‚¬ë‚´ ì¤‘ê³ ê±°ë˜ ê²Œì‹œíŒì…ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)</p>
                        <div class="mt-8 p-6 bg-gray-50 rounded-lg text-center border-2 border-dashed border-gray-300 text-gray-500">
                            <p class="text-lg font-semibold mb-2">ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ ì•ˆë‚´</p>
                            <p>ë” ë‚˜ì€ ì‚¬ë‚´ êµí™˜/ë‚˜ëˆ” ì‹œìŠ¤í…œì„ ìœ„í•´ ë‹¹ê·¼ íƒ­ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”!ğŸ¥•</p>
                        </div>
                    `;
                }
                div.innerHTML = contentHTML;
                contentContainer.appendChild(div);
            });

            // 5. í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            const trainingForm = document.getElementById('training-post-form');
            if(trainingForm) trainingForm.addEventListener('submit', window.saveTrainingPost);
            const communityForm = document.getElementById('community-post-form');
            if(communityForm) communityForm.addEventListener('submit', window.saveCommunityPost);
            const annualPlanCreateForm = document.getElementById('annual-plan-create-form');
            if(annualPlanCreateForm) annualPlanCreateForm.addEventListener('submit', window.saveAnnualPlan);

            // 6. ê¸°ë³¸ íƒ­ í™œì„±í™” (êµìœ¡ìë£Œ ê³µìœ )
            setActiveTab(tabs[1].name);
        };
    </script>
</body>
</html>
